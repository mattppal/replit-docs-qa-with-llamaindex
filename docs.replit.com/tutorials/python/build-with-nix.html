<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/python/build-with-nix">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Building with Nix on Replit | Replit Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.replit.com/tutorials/python/build-with-nix"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image" content="https://pbs.twimg.com/card_img/1622937266980093953/r1yP8OZZ?format=png&amp;name=small"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Building with Nix on Replit | Replit Docs"><meta data-rh="true" name="description" content="As of May 2021, Replit supports all programming languages through the power of Nix. But Nix can do a whole lot more than just enable us to use new languages. In this article, we&#x27;ll cover several different use-cases for Nix on Replit, including:"><meta data-rh="true" property="og:description" content="As of May 2021, Replit supports all programming languages through the power of Nix. But Nix can do a whole lot more than just enable us to use new languages. In this article, we&#x27;ll cover several different use-cases for Nix on Replit, including:"><link data-rh="true" rel="icon" href="../../image/favicon-2.png"><link data-rh="true" rel="canonical" href="build-with-nix.html"><link data-rh="true" rel="alternate" href="build-with-nix.html" hreflang="en"><link data-rh="true" rel="alternate" href="build-with-nix.html" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="../../updates/rss.xml" title="Replit Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="../../updates/atom.xml" title="Replit Docs Atom Feed">




<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var o=Array.prototype.slice.call(arguments);return o.unshift(t),e.push(o),e}};for(var t=0;t<e.methods.length;t++){var o=e.methods[t];e[o]=e.factory(o)}e.load=function(t,o){var r=document.createElement("script");r.type="text/javascript",r.defer=!0,r.src="https://sp.replit.com/sdk.js/v1/"+t+"/sdk.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n),e._loadOptions=o},e.SNIPPET_VERSION="4.15.3",e.load("dne7BWxTufWARK8acyNrH72I5y7ybaQ7",{integrations:{"Segment.io":{apiHost:"sp.replit.com/v1"}}}),e.page("docs")}}()</script><link rel="stylesheet" href="../../assets/css/styles.2ca24b24.css">
<link rel="preload" href="../../assets/js/runtime~main.1e833c70.js" as="script">
<link rel="preload" href="../../assets/js/main.bcce7b23.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div class="replit-extension"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="build-with-nix.html#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://replit.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_self" href="../../index.html">Docs</a><a class="navbar__item navbar__link" target="_self" href="../../updates.html">Changelog</a><a class="navbar__item navbar__link" target="_self" href="../../extensions.html">Extensions</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div><div class="navbar__item"><a href="https://replit.com/signup" target="_blank" class="sign-up-button">Sign Up</a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a href="https://replit.com" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_isFc"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/getting-started.html">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/the-replit-workspace.html">The Replit Workspace</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Replit Workspace&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/power-ups.html">Power Ups</a><button aria-label="Toggle the collapsible sidebar category &#x27;Power Ups&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/hosting.html">Hosting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hosting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/cycles.html">Cycles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cycles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/themes.html">Themes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Themes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/bounties.html">Bounties</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bounties&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/extensions.html">Extensions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extensions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/mobile-app.html">Mobile App</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mobile App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../model-farm/index.html">ModelFarm</a><button aria-label="Toggle the collapsible sidebar category &#x27;ModelFarm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/organizations.html">Organizations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Organizations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-for-education.html">Teams for Education</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams for Education&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-pro.html">Teams Pro</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams Pro&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="../overview.html">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/replit--nix.html">Replit &amp; Nix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit &amp; Nix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="../../category/python.html">Python</a><button aria-label="Toggle the collapsible sidebar category &#x27;Python&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-basic-discord-bot-python.html">Building a Discord bot with Python and Replit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="discord-meme-maker-bot.html">Discord meme maker bot with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="discord-rpg-bot.html">Discord RPG bot with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="2d-platform-game.html">2D Platform Game with PyGame</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="audio.html">Audio: create a media player</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-card-game-pygame.html">Card game with pygame</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-news-digest-app-with-nix.html">Email news digest app with Nix &amp; Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-snake-with-pygame.html">Snake game with PyGame</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="build-with-nix.html">Building with Nix on Replit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="building-a-game-with-pygame.html">Juggling with PyGame</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="creating-interactive-python-plots-matplotlib.html">Creating interactive Python plots with matplotlib</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="data-science-and-visualisation-with-repl-it.html">Data science</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="discord-role-bot.html">Discord role assignment bot with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="internal-organization-tool.html">Building an internal organization tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="paid-content-site.html">Paid content site with replit.web &amp; Stripe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="pdf-report-generator-from-spreadsheet.html">PDF report generator from spreadsheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="personal-stock-market-dashboard.html">Stock market dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="spotify-api-tutorials.html">Spotify API tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="static-site-generator.html">Static site generator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="steganography.html">Steganography: hiding messages in images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="technical-challenge-site.html">Technical challenge site with replit.web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="telegram-bot.html">Telegram bot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="test-driven-development.html">Test-driven development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="two-player-wordle-clone-python-rich.html">Wordle with Python &amp; Rich</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="using-the-replit-database.html">Databases: build a phonebook</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/nodejs.html">Node.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Node.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/kaboomjs.html">Kaboom.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kaboom.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/web3.html">Web3</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web3&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/html-css-and-js.html">HTML, CSS, and JS</a><button aria-label="Toggle the collapsible sidebar category &#x27;HTML, CSS, and JS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/miscellanious.html">Miscellanious</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellanious&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teaching-curriculum.html">Teaching Curriculum</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teaching Curriculum&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/replit-books.html">Replit Books</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit Books&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/legal-and-security-info.html">Legal and Security Info</a><button aria-label="Toggle the collapsible sidebar category &#x27;Legal and Security Info&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="../../index.html"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../overview.html"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../../category/python.html"><span itemprop="name">Python</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Building with Nix on Replit</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Building with Nix on Replit</h1><p>As of May 2021, Replit <a href="https://blog.replit.com/nix" target="_blank" rel="noopener noreferrer">supports all programming languages through the power of Nix</a>. But Nix can do a whole lot more than just enable us to use new languages. In this article, we&#x27;ll cover several different use-cases for Nix on Replit, including:</p><ul><li>Setting up a production-grade web stack, with a database and support for multiple web servers.</li><li>Running third-party programs in Replit.</li><li>Playing DOOM in a repl.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-nix">What is Nix?<a href="build-with-nix.html#what-is-nix" class="hash-link" aria-label="Direct link to What is Nix?" title="Direct link to What is Nix?">​</a></h3><p>Nix is a tool designed for managing packages and system configurations. It has some similarities to package managers you may have used in the past, such as Homebrew on macOS, APT on Debian-based Linux distributions, Python&#x27;s pip, or Node.js&#x27;s NPM. If you haven&#x27;t used a package manager before, it&#x27;s basically an app store.</p><p>When you install a package with a traditional package manager – say you want to install a browser like Firefox – it will download some files, unpack them in various places on your system, and run some configuration scripts. It will also install all of the additional programs and libraries Firefox needs to run. Many of these will have dependencies themselves, and so it will install those too. Ultimately, installing a single package can require many more installations and result in widespread changes to your system.</p><p>Sometimes, packages will be incompatible with each other, due to relying on different versions of the same dependency. For example, App #1 depends on <code>libxyz 1.4</code> and App #2 depends on <code>libxyz 1.5</code>. Installing App #2 upgrades <code>libxyz</code> and breaks App #1. Downgrading <code>libxyz</code> fixes App #1 but breaks App #2.</p><p>This is called <a href="https://en.wikipedia.org/wiki/Dependency_hell" target="_blank" rel="noopener noreferrer">dependency hell</a>, and it&#x27;s one of the problems Nix was designed to solve. Whereas a standard package manager might install <a href="https://www.vim.org/" target="_blank" rel="noopener noreferrer">Vim</a> to <code>/usr/bin/vim</code>, nix will install it to a directory that looks like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/nix/store/&lt;hash&gt;-vim-&lt;version&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The directory name has three components: the package name, the version, and a hash of all the package information, such as configuration options. Two packages on two different systems with the same hash will be identical, but two packages with the same name and version but different hashes will have slight differences. Because of this, we can install multiple versions of the same package, neatly solving our App #1 and App #2 dependency hell.</p><p>Whereas a package manager like APT might scatter the contents of an installed program across <code>/bin</code>, <code>/etc</code>, <code>/usr</code>, and other directories that require special privileges to write to, Nix keeps everything in <code>/nix/store</code>. This lets us securely install packages as a non-privileged user.</p><p>Packages in Nix are built using <em>derivations</em>, which you can think of as build scripts. All derivations are written in the Nix language, a functional programming language, similar to Haskell or F#. If you haven&#x27;t used a functional language before, the most fundamental thing to understand is that there isn&#x27;t any persistent state, i.e. you can&#x27;t define variables outside of functions. Functional languages are composed of functions that take some input and produce some output. Every time a function is executed with a given input, it will return the same output. This requires a different approach to traditional imperative programming languages but enhances predictability and reproducibility of output, two very good qualities for a build system.</p><p>To learn more about Nix, check out the following resources:</p><ul><li><a href="https://nixos.org/guides/nix-pills/" target="_blank" rel="noopener noreferrer">Nix Pills</a>: A guided introduction to Nix, split into self-contained chapters, or &quot;pills&quot;.</li><li><a href="https://www.youtube.com/playlist?list=PLRGI9KQ3_HP_OFRG6R-p4iFgMSK1t5BHs" target="_blank" rel="noopener noreferrer">Nixology</a>: A series of videos introducing Nix.</li><li><a href="https://nixos.org/manual/nix/stable/" target="_blank" rel="noopener noreferrer">Nix Package Manager Guide</a>: The official Nix Package Manager manual.</li><li><a href="https://nixcloud.io/tour" target="_blank" rel="noopener noreferrer">A tour of Nix</a>: An overview of the Nix language.</li><li><a href="https://nix.dev" target="_blank" rel="noopener noreferrer">nix.dev</a>: Getting started tutorials</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-can-we-use-nix-on-replit">How can we use Nix on Replit?<a href="build-with-nix.html#how-can-we-use-nix-on-replit" class="hash-link" aria-label="Direct link to How can we use Nix on Replit?" title="Direct link to How can we use Nix on Replit?">​</a></h3><p>Every repl you create is backed by a <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a> container. Anything you do from your repl, from running code to executing commands in the shell, will happen in the context of the <code>runner</code> user in this container. For reasons of security, this user does not have root privileges, and therefore cannot install packages using a traditional package manager like APT. But the <code>runner</code> in a Nix repl can install packages with Nix.</p><p>This opens up an enormous array of possibilities. In previous tutorials, we&#x27;ve focused on using repls to run custom code in various languages. The Replit Database makes it possible to create applications with persistent storage, but Nix allows us to use a standard DBMS like MySQL or Postgres. We can also install webservers and even graphical programs like Inkscape and LibreOffice.</p><p>Essentially, Nix turns our repl into a fully fledged server. In the next few sections, we&#x27;ll cover some of the things we can do as a result.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="deploying-a-production-web-stack-on-replit-with-nix">Deploying a production web stack on Replit with Nix<a href="build-with-nix.html#deploying-a-production-web-stack-on-replit-with-nix" class="hash-link" aria-label="Direct link to Deploying a production web stack on Replit with Nix" title="Direct link to Deploying a production web stack on Replit with Nix">​</a></h2><p>The first thing we&#x27;ll build with Nix is a production web stack with the following components:</p><ul><li>Python Flask as the application server.</li><li>Waitress as the <a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface" target="_blank" rel="noopener noreferrer">Web Server Gateway Interface</a>.</li><li>NGINX as the web server.</li><li>Postgres as the SQL database.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-waitress">Why Waitress?<a href="build-with-nix.html#why-waitress" class="hash-link" aria-label="Direct link to Why Waitress?" title="Direct link to Why Waitress?">​</a></h3><p>If you&#x27;ve built anything with Python and Flask, such as one of our previous tutorials, you will have used Flask&#x27;s development server to interact with your application. While this server is great for development and debugging, it&#x27;s optimised for a single user and gets quite slow if more than one person tries to use it.</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/30-build-with-nix/dev-server.png" alt="Flask development server" class="img_ev3q"></p><p>We can improve the speed of our Flask apps by using a production-grade <a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface" target="_blank" rel="noopener noreferrer">WSGI</a> server in place of Flask&#x27;s default, such as <a href="https://gunicorn.org/" target="_blank" rel="noopener noreferrer">Gunicorn</a> or <a href="https://pypi.org/project/waitress/" target="_blank" rel="noopener noreferrer">Waitress</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-nginx">Why NGINX?<a href="build-with-nix.html#why-nginx" class="hash-link" aria-label="Direct link to Why NGINX?" title="Direct link to Why NGINX?">​</a></h3><p>What if we want to host more than just a Flask app? Let&#x27;s consider an e-commerce site at <code>www.example.com</code>. The main store application is powered by Flask, but our marketing department would like to start a blog at <code>www.example.com/blog</code>. We could build blogging functionality into our e-commerce site, but it would be much quicker and easier to use a separate application, such as <a href="https://wordpress.org/" target="_blank" rel="noopener noreferrer">Wordpress</a> or <a href="https://ghost.org/" target="_blank" rel="noopener noreferrer">Ghost</a>.</p><p>This is where a fully featured web server, such as NGINX or Apache, comes in. These web servers can be configured to serve several different applications and content directories at different locations on one or more domains. They&#x27;re also much faster at serving static content than even a production-grade WSGI server, so even single-app deployments benefit from using them.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-postgres">Why Postgres?<a href="build-with-nix.html#why-postgres" class="hash-link" aria-label="Direct link to Why Postgres?" title="Direct link to Why Postgres?">​</a></h3><p>We&#x27;ve used Replit&#x27;s Database for persistent storage in several previous tutorials. While it&#x27;s easy to use in supported languages like Python, it doesn&#x27;t have the power and flexibility of a mainstream SQL database, and we can&#x27;t continue using it if we ever move our code out of Replit. Postgres is a popular SQL database used by many, from small startups to tech giants like Apple, Reddit and Spotify. We can use it too if we install it on Nix.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="repl-overview">Repl overview<a href="build-with-nix.html#repl-overview" class="hash-link" aria-label="Direct link to Repl overview" title="Direct link to Repl overview">​</a></h3><p>We&#x27;ve made a Nix repl containing the production web stack available here: <a href="https://replit.com/@ritza/nix-template" target="_blank" rel="noopener noreferrer">https://replit.com/@ritza/nix-template</a></p><p>Open it now, or fork it to your profile, and we&#x27;ll go over how it works. Ensure that the repl&#x27;s config files are showing.</p><p>![Show configuration]<!-- -->(<a href="https://docimg.replit.com/images/tutorials/30-build-with-nix/" target="_blank" rel="noopener noreferrer">https://docimg.replit.com/images/tutorials/30-build-with-nix/</a>
show-hidden-files.png)</p><p>The first file we&#x27;ll look at is <code>replit.nix</code>. This is the base Nix file that tells our repl what packages to install. In the <a href="https://replit.com/@ritza/nix" target="_blank" rel="noopener noreferrer">default Nix repl</a>, it looks like this:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.cowsay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line, <code>{ pkgs }:</code>, defines an anonymous function that takes a single argument, <code>pkgs</code>. When we run our repl, this function will be called and its contents executed. In this case, its contents is a list of packages to install, one item long. Therefore, all this function does is install <code>cowsay</code>, a program that prints an ASCII cow.</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/30-build-with-nix/cowsay.png" alt="Cowsay" class="img_ev3q"></p><p>By contrast, the <code>replit.nix</code> file in our production web stack repl is more complicated. It looks like this:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginxModified = pkgs.nginx.overrideAttrs (oldAttrs: rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configureFlags = oldAttrs.configureFlags ++ [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-client-body-temp-path=/home/runner/REPL-NAME-HERE/cache/client_body&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-proxy-temp-path=/home/runner/REPL-NAME-HERE/cache/proxy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-fastcgi-temp-path=/home/runner/REPL-NAME-HERE/cache/fastcgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-uwsgi-temp-path=/home/runner/REPL-NAME-HERE/cache/uwsgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-scgi-temp-path=/home/runner/REPL-NAME-HERE/cache/scgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nginxModified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.python39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.python39Packages.flask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.python39Packages.waitress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.postgresql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkgs.python39Packages.psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should recognise some similarities between this code and the default <code>replit.nix</code>. We&#x27;re still defining an anonymous function that takes <code>pkgs</code>, but now we&#x27;re installing more than one package.</p><p>All of the packages in <code>deps</code> are straight from Nix&#x27;s package repository, except for <code>nginxModified</code>. We need to make some modifications to <code>nginx</code> to get it to run in our repl. Nix&#x27;s language and system configuration abilities make this much simpler to do than if we were using a different package manager that didn&#x27;t support recompiling packages.</p><p>Nix&#x27;s <code>let ... in { ... }</code> control structure is used when we want to define local variables used in a given function. We define the variables after <code>let</code> and then use them after <code>in</code>. Let&#x27;s take a closer look at the definition of <code>nginxModified</code>:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    nginxModified = pkgs.nginx.overrideAttrs (oldAttrs: rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configureFlags = oldAttrs.configureFlags ++ [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-client-body-temp-path=/home/runner/REPL-NAME-HERE/cache/client_body&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-proxy-temp-path=/home/runner/REPL-NAME-HERE/cache/proxy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-fastcgi-temp-path=/home/runner/REPL-NAME-HERE/cache/fastcgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-uwsgi-temp-path=/home/runner/REPL-NAME-HERE/cache/uwsgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;--http-scgi-temp-path=/home/runner/REPL-NAME-HERE/cache/scgi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we&#x27;re taking <code>pkgs.nginx</code> and calling <a href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideAttrs" target="_blank" rel="noopener noreferrer"><code>overrideAttrs</code></a> to change the configuration flags that are set when compiling NGINX. We need to add a few flags that change the paths NGINX uses to paths that are accessible in our repl. Note that we&#x27;ve created all the directories in the expected locations.</p><p><a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/http/nginx/generic.nix" target="_blank" rel="noopener noreferrer">The derivation that runs when we install <code>pkgs.nginx</code> can be found here</a>. Our version will do the same things, but with a few extra items in <code>configureFlags</code>.</p><p>That&#x27;s it for <code>replit.nix</code>. Now let&#x27;s take a look at <code>.replit</code>. This file defines what command will get executed when we click the &quot;Run&quot; button, and what custom environment variables will be available to our repl.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sh start.sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PGDATA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/runner/</span><span class="token string variable" style="color:#36acaa">${REPL_SLUG}</span><span class="token string" style="color:#e3116c">/data&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ll execute the shell script <code>start.sh</code> when we press &quot;Run&quot;, and we have defined <code>PGDATA</code>, an environment variable Postgres uses to locate its data directory. Let&#x27;s look at <code>start.sh</code> next:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># start Postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_ctl stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp postgresql.conf.tpl data/postgresql.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socker_dir=&quot;\/home\/runner\/${REPL_SLUG}\/postgres&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s/replace_unix_dir/${socker_dir}/&quot; data/postgresql.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pg_ctl -l /home/runner/${REPL_SLUG}/postgresql.log start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createdb -h 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">psql -h 127.0.0.1 -c &quot;create database appdb;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkill nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -e /home/runner/$REPL_SLUG/logs/error.log -c /home/runner/$REPL_SLUG/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start Flask app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python main.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order, we start Postgres, then NGINX, and then our Python Flask application.</p><p>Our Postgres code first stops any existing instances of Postgres, then calls <code>initdb</code>, which will create a new database at the directory specified in <code>$PGDATA</code> if none exists. We then copy our Postgres configuration file into our data directory and use <code>sed</code> to fill in its <code>unix_socket_directories</code> value, another directory we need to change to get things working in a repl.</p><p>The file <code>postgressql.conf.tpl</code> is long and mostly unimportant. The only part of that file that will be relevant for basic use is the following lines under the heading &quot;Connection Settings&quot;:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># - Connection Settings -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listen_addresses = &#x27;127.0.0.1&#x27;      # what IP address(es) to listen on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # comma-separated list of addresses;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # defaults to &#x27;localhost&#x27;; use &#x27;*&#x27; for all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # (change requires restart)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 5432             # (change requires restart)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These lines set the database to listen on the <a href="https://en.wikipedia.org/wiki/Localhost#Loopback" target="_blank" rel="noopener noreferrer">local loopback</a> on TCP port 5432. This will allow other programs in our repl to connect to it over the network, without having it exposed to the internet or other repls. This is relevant for the next few lines of our script:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pg_ctl -l /home/runner/${REPL_SLUG}/postgresql.log start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createdb -h 127.0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">psql -h 127.0.0.1 -c &quot;create database appdb;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line starts our database, and the last two create a Postgres instance usable by <code>runner</code> and within that, a database named <code>appdb</code>. Both of these lines will fail on subsequent runs of <code>start.sh</code> (if the database has already been created), so we don&#x27;t need to worry about overwriting our database every time we run our repl.</p><p>The code for starting NGINX is simpler:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># start nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkill nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -e /home/runner/$REPL_SLUG/logs/error.log -c /home/runner/$REPL_SLUG/nginx.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>First, we kill any existing <code>nginx</code> processes, and then we start NGINX, telling it to write errors to <code>logs/error.log</code> and use the configuration file <code>nginx.conf</code>. Like <code>postgresql.conf</code>, this configuration file is mostly unimportant for basic use. The following changes have been made from Nix&#x27;s default NGINX configuration file:</p><ol><li><p>The option <code>pid</code> specifies a repl-accessible PID file location:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pid        /home/runner/REPL-NAME-HERE/logs/nginx.pid;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The option <code>access_log</code> in the <code>http</code> block specifies a repl-accessible access log file location:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">access_log  /home/runner/REPL-NAME-HERE/logs/access.log;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The <code>server</code> block has been changed to host our Python server, as detailed below.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen       8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #charset koi8-r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #access_log  logs/host.access.log  main;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass   http://127.0.0.1:8181;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #error_page  404              /404.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # redirect server error pages to the static page /50x.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>In NGINX, <code>server</code> blocks are what you use to set up websites on individual domains. Each domain (e.g. <code>example.com</code>) or subdomain (e.g. <code>blog.example.com</code>) will have its own server block. To create a <code>server</code> block that will define what our repl hosts, we use the following NGINX directives:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    listen  8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  localhost;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we&#x27;ve set NGINX up to run our server on TCP port 8080, as per <a href="../../hosting/deployments/about-deployments.html">Replit&#x27;s hosting guidelines</a>. Within our <code>server</code> block, we can have one or more <code>location</code> blocks. These tell NGINX what content to host at different URLs. We can use the <code>proxy_pass</code> directive to serve the contents of another webserver running in our repl, or the <code>root</code> directive to serve static files. You can learn more about configuring NGINX in the official <a href="http://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="noopener noreferrer">NGINX Beginner&#x27;s Guide</a>.</p><p>The last thing we do in <code>start.sh</code> is start up our Python Flask server:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># start Flask app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python main.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code for <code>main.py</code> should look familiar if you&#x27;ve used Flask before:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> flask </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Flask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> waitress </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> serve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psycopg2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        database</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;appdb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;SELECT version()&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db_version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fetchone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Hello from Python! PostgreSQL database version: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">db_version</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#app.run(host=&#x27;127.0.0.1&#x27;, port=8181) # dev server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;127.0.0.1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8181</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url_scheme</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;https&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># production server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this code, we&#x27;ve created a Flask application that connects to our Postgres database and is served on the local loopback address at TCP port 8181 by the Waitress WSGI server.</p><p>If you run the repl now, you&#x27;ll see a page showing version information about our PostgreSQL database.</p><p>From this base, you can build and configure a production-ready web application. Try the following ideas:</p><ul><li>Implement the code from one of our previous Flask-based tutorials, such as <a href="pdf-report-generator-from-spreadsheet.html">this PDF report generator</a>. See if you can adapt the content to use Postgres rather than the Replit Database.</li><li>Implement your own Flask web application, using Postgres as a database.</li><li>Add a second application listening on a different loopback port and available from a different URL. This could be your own Python or Node.js project, or a deployment of open-source software such as Ghost or Wordpress.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-few-other-things-you-can-do-with-nix-and-replit">A few other things you can do with Nix and Replit<a href="build-with-nix.html#a-few-other-things-you-can-do-with-nix-and-replit" class="hash-link" aria-label="Direct link to A few other things you can do with Nix and Replit" title="Direct link to A few other things you can do with Nix and Replit">​</a></h2><p>We started with a complex example to give you an idea of the power and potential of Nix, but there are a few other things you can do with it that don&#x27;t require the same amount of set up.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jupyter-notebook">Jupyter Notebook<a href="build-with-nix.html#jupyter-notebook" class="hash-link" aria-label="Direct link to Jupyter Notebook" title="Direct link to Jupyter Notebook">​</a></h3><p>You can run a <a href="https://jupyter.org/" target="_blank" rel="noopener noreferrer">Jupyter Notebook</a> in a Nix repl. Add <code>pkgs.jupyter</code> to the deps list in <code>replit.nix</code>, set <code>run</code> in <code>.replit</code> to <code>sh start.sh</code>, and create a <code>start.sh</code> script with the following contents:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jupyter notebook --ip 0.0.0.0 --port 8080 --notebook-dir /home/runner/$REPL_SLUG/data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notebooks are web-based interactive development environments that allow you to mix runnable code, text notes, mathematical equations, and charts and graphs. They&#x27;re often used by data scientists.</p><p><a href="https://replit.com/@ritza/nix-jupyter" target="_blank" rel="noopener noreferrer">https://replit.com/@ritza/nix-jupyter</a></p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/30-build-with-nix/jupyter-notebook.png" alt="Jupyter notebook" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vscode-server">VSCode Server<a href="build-with-nix.html#vscode-server" class="hash-link" aria-label="Direct link to VSCode Server" title="Direct link to VSCode Server">​</a></h3><p>You can run a Visual Studio Code Server, which will allow you to use a personal, customised version of the popular text editor from anywhere, simply by navigating to your repl&#x27;s URL.</p><p><a href="https://replit.com/@ritza/nix-vscode-server" target="_blank" rel="noopener noreferrer">https://replit.com/@ritza/nix-vscode-server</a></p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/30-build-with-nix/vscode-server.png" alt="VS Code server" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="alternative-web-stacks">Alternative web stacks<a href="build-with-nix.html#alternative-web-stacks" class="hash-link" aria-label="Direct link to Alternative web stacks" title="Direct link to Alternative web stacks">​</a></h3><p>Instead of NGINX, you could use <a href="https://httpd.apache.org/" target="_blank" rel="noopener noreferrer">Apache</a>, and instead of Postgres, you could try <a href="https://www.mysql.com/" target="_blank" rel="noopener noreferrer">MySQL</a> or even a <a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener noreferrer">NoSQL</a> database like <a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB</a>. And of course, you can use just about any mainstream programming language to write your web application code instead of Python, such as JavaScript, Ruby or Java.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="other-programming-languages">Other programming languages<a href="build-with-nix.html#other-programming-languages" class="hash-link" aria-label="Direct link to Other programming languages" title="Direct link to Other programming languages">​</a></h3><p>You can set up and use a programming language that is not officially supported by Replit, such as <a href="https://racket-lang.org/" target="_blank" rel="noopener noreferrer">Racket</a> (<code>nixpkgs.racket</code>), <a href="https://www.swi-prolog.org/" target="_blank" rel="noopener noreferrer">Prolog</a> (<code>nixpkgs.swiProlog</code>), or even <a href="https://en.wikipedia.org/wiki/COBOL" target="_blank" rel="noopener noreferrer">COBOL</a> (<code>nixpkgs.gnu-cobol</code>).</p><p><a href="https://replit.com/@ritza/nix-cobol" target="_blank" rel="noopener noreferrer">https://replit.com/@ritza/nix-cobol</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dosbox">DOSBox<a href="build-with-nix.html#dosbox" class="hash-link" aria-label="Direct link to DOSBox" title="Direct link to DOSBox">​</a></h3><p>We can get the popular MS-DOS emulator <a href="https://www.dosbox.com/" target="_blank" rel="noopener noreferrer">DOSBox</a> working in a Nix repl by just installing the right package and running it. From there, we can run any DOS program and use it in our repl&#x27;s VNC window.</p><p><a href="https://replit.com/@ritza/nix-dosbox" target="_blank" rel="noopener noreferrer">https://replit.com/@ritza/nix-dosbox</a></p><p>Here&#x27;s DOOM in a repl:</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/30-build-with-nix/doom.png" alt="Doom" class="img_ev3q"></p><p>Other DOS programs you can try:</p><ul><li><a href="https://www.liero.be/" target="_blank" rel="noopener noreferrer">Liero</a>, a keyboard-sharing worm fighting game.</li><li>WordStar 4.0, the word processor George RR Martin uses to write the <em>Game of Thrones</em> book series.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="general-tips-for-building-with-nix-repls">General tips for building with Nix repls<a href="build-with-nix.html#general-tips-for-building-with-nix-repls" class="hash-link" aria-label="Direct link to General tips for building with Nix repls" title="Direct link to General tips for building with Nix repls">​</a></h2><p>As we&#x27;ve seen above, Nix allows us to use repls for more than just writing and testing code, but some packages require a fair amount of configuration to get working. Here are a few general tips for getting packages working in Nix repls:</p><ul><li>First, search for the package you want on the <a href="https://search.nixos.org/packages" target="_blank" rel="noopener noreferrer">Nix package search website</a> and add it to <code>deps</code> in <code>replit.nix</code>. If you don&#x27;t see any errors in the console after running your repl, it probably worked. Some packages need to be manually started by specifying a run command in <code>.replit</code>, while others will start automatically.</li><li>Most of the installation errors you&#x27;ll encounter will relate to file paths that don&#x27;t exist in your repl, or that you don&#x27;t have permission to access. These can generally be fixed if you can configure your package to look for those files in your repl&#x27;s file list instead, which is hosted on disk at <code>/home/runner/REPL-NAME-HERE/</code>. Depending on the package, you may be able to do this with a custom configuration file, like we did with Postgres, or you may need to alter the way Nix installs it, as we did with NGINX.</li><li>You can view files and directories that aren&#x27;t visible in your repl&#x27;s filepane from the shell, using standard Unix commands like <code>ls</code>, <code>cd</code> and <code>cat</code>. This includes files and directories in the Nix store, at <code>/nix/store</code>. This will often be useful for debugging.</li><li>You can view a list of running processes with the shell command <code>ps aux</code>, and terminate them with <code>pkill &lt;process-name&gt;</code>.</li><li>Loading the Nix environment will sometimes take a long time, especially if you have custom derivations.</li><li>If you&#x27;re setting up a web server, refer to <a href="../../hosting/deployments/about-deployments.html">our guidance on deploying HTTP servers</a>.</li></ul><p>As a final reminder, make sure to abide by Replit&#x27;s <a href="https://replit.com/site/terms" target="_blank" rel="noopener noreferrer">Terms of Service</a> when using Nix repls, and avoid installing packages that use excessive system resources (such as cryptocurrency miners) or are intentionally malicious.</p></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="flexer_Eq2A prev_vqcT"><a class="link_ZrPi" href="build-snake-with-pygame.html"><span>&lt; Previous<!-- -->: <!-- -->Snake game with PyGame</span></a></div><div class="flexer_Eq2A"><a class="link_ZrPi" href="building-a-game-with-pygame.html"><span>Next<!-- -->: <!-- -->Juggling with PyGame<!-- --> &gt;</span></a></div></nav><footer class="theme-doc-footer docusaurus-mt-lg footer_cxLd"><div class="docs-rating-wrapper"><div class="docs-rating-widget"><span class="helpfulness-indication">Was this helpful?</span><div class="docs-rating-button-wrapper"><button><span>👎</span></button><button><span>👍</span></button></div></div></div><div class="theme-doc-footer-edit-meta-row row editDocContainer_Wpgd"><div></div><div style="flex-grow:1"></div><div class="lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-31T22:34:37.000Z">Aug 31, 2023</time></b></span></div></div></footer></article></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="build-with-nix.html#what-is-nix" class="table-of-contents__link toc-highlight">What is Nix?</a></li><li><a href="build-with-nix.html#how-can-we-use-nix-on-replit" class="table-of-contents__link toc-highlight">How can we use Nix on Replit?</a></li><li><a href="build-with-nix.html#deploying-a-production-web-stack-on-replit-with-nix" class="table-of-contents__link toc-highlight">Deploying a production web stack on Replit with Nix</a><ul><li><a href="build-with-nix.html#why-waitress" class="table-of-contents__link toc-highlight">Why Waitress?</a></li><li><a href="build-with-nix.html#why-nginx" class="table-of-contents__link toc-highlight">Why NGINX?</a></li><li><a href="build-with-nix.html#why-postgres" class="table-of-contents__link toc-highlight">Why Postgres?</a></li><li><a href="build-with-nix.html#repl-overview" class="table-of-contents__link toc-highlight">Repl overview</a></li></ul></li><li><a href="build-with-nix.html#a-few-other-things-you-can-do-with-nix-and-replit" class="table-of-contents__link toc-highlight">A few other things you can do with Nix and Replit</a><ul><li><a href="build-with-nix.html#jupyter-notebook" class="table-of-contents__link toc-highlight">Jupyter Notebook</a></li><li><a href="build-with-nix.html#vscode-server" class="table-of-contents__link toc-highlight">VSCode Server</a></li><li><a href="build-with-nix.html#alternative-web-stacks" class="table-of-contents__link toc-highlight">Alternative web stacks</a></li><li><a href="build-with-nix.html#other-programming-languages" class="table-of-contents__link toc-highlight">Other programming languages</a></li><li><a href="build-with-nix.html#dosbox" class="table-of-contents__link toc-highlight">DOSBox</a></li></ul></li><li><a href="build-with-nix.html#general-tips-for-building-with-nix-repls" class="table-of-contents__link toc-highlight">General tips for building with Nix repls</a></li></ul></div></div></div></div></main></div></div></div></div>
<script src="../../assets/js/runtime~main.1e833c70.js"></script>
<script src="../../assets/js/main.bcce7b23.js"></script>
</body>
</html>