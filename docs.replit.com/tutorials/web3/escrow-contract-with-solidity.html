<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/web3/escrow-contract-with-solidity">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Escrow contract with Solidity | Replit Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.replit.com/tutorials/web3/escrow-contract-with-solidity"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image" content="https://pbs.twimg.com/card_img/1622937266980093953/r1yP8OZZ?format=png&amp;name=small"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Escrow contract with Solidity | Replit Docs"><meta data-rh="true" name="description" content="Since Satoshi Nakamoto released the first version of Bitcoin in early 2009, digital currencies and blockchain technology have been the site of frenzied innovation, excitement and speculation. In addition to Bitcoin itself, hundreds of competing and complementary blockchains and currencies have come and gone. In this tutorial, we will be looking at Ethereum, the second most popular and widely used cryptocurrency after Bitcoin."><meta data-rh="true" property="og:description" content="Since Satoshi Nakamoto released the first version of Bitcoin in early 2009, digital currencies and blockchain technology have been the site of frenzied innovation, excitement and speculation. In addition to Bitcoin itself, hundreds of competing and complementary blockchains and currencies have come and gone. In this tutorial, we will be looking at Ethereum, the second most popular and widely used cryptocurrency after Bitcoin."><link data-rh="true" rel="icon" href="../../image/favicon-2.png"><link data-rh="true" rel="canonical" href="escrow-contract-with-solidity.html"><link data-rh="true" rel="alternate" href="escrow-contract-with-solidity.html" hreflang="en"><link data-rh="true" rel="alternate" href="escrow-contract-with-solidity.html" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="../../updates/rss.xml" title="Replit Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="../../updates/atom.xml" title="Replit Docs Atom Feed">




<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var o=Array.prototype.slice.call(arguments);return o.unshift(t),e.push(o),e}};for(var t=0;t<e.methods.length;t++){var o=e.methods[t];e[o]=e.factory(o)}e.load=function(t,o){var r=document.createElement("script");r.type="text/javascript",r.defer=!0,r.src="https://sp.replit.com/sdk.js/v1/"+t+"/sdk.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n),e._loadOptions=o},e.SNIPPET_VERSION="4.15.3",e.load("dne7BWxTufWARK8acyNrH72I5y7ybaQ7",{integrations:{"Segment.io":{apiHost:"sp.replit.com/v1"}}}),e.page("docs")}}()</script><link rel="stylesheet" href="../../assets/css/styles.2ca24b24.css">
<link rel="preload" href="../../assets/js/runtime~main.1e833c70.js" as="script">
<link rel="preload" href="../../assets/js/main.bcce7b23.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div class="replit-extension"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="escrow-contract-with-solidity.html#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://replit.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_self" href="../../index.html">Docs</a><a class="navbar__item navbar__link" target="_self" href="../../updates.html">Changelog</a><a class="navbar__item navbar__link" target="_self" href="../../extensions.html">Extensions</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div><div class="navbar__item"><a href="https://replit.com/signup" target="_blank" class="sign-up-button">Sign Up</a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a href="https://replit.com" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_isFc"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/getting-started.html">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/the-replit-workspace.html">The Replit Workspace</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Replit Workspace&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/power-ups.html">Power Ups</a><button aria-label="Toggle the collapsible sidebar category &#x27;Power Ups&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/hosting.html">Hosting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hosting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/cycles.html">Cycles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cycles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/themes.html">Themes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Themes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/bounties.html">Bounties</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bounties&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/extensions.html">Extensions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extensions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/mobile-app.html">Mobile App</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mobile App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../model-farm/index.html">ModelFarm</a><button aria-label="Toggle the collapsible sidebar category &#x27;ModelFarm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/organizations.html">Organizations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Organizations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-for-education.html">Teams for Education</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams for Education&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-pro.html">Teams Pro</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams Pro&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="../overview.html">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/replit--nix.html">Replit &amp; Nix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit &amp; Nix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/python.html">Python</a><button aria-label="Toggle the collapsible sidebar category &#x27;Python&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/nodejs.html">Node.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Node.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/kaboomjs.html">Kaboom.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kaboom.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="../../category/web3.html">Web3</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web3&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-a-robot-nft-p2.html">Robot NFT Part 2: Frontend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-a-robot-nft.html">Robot NFT Part 1: on Ethereum blockchain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-smart-contract-oracle.html">Smart contract oracle with Solidity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="escrow-contract-with-solidity.html">Escrow contract with Solidity</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/html-css-and-js.html">HTML, CSS, and JS</a><button aria-label="Toggle the collapsible sidebar category &#x27;HTML, CSS, and JS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/miscellanious.html">Miscellanious</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellanious&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teaching-curriculum.html">Teaching Curriculum</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teaching Curriculum&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/replit-books.html">Replit Books</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit Books&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/legal-and-security-info.html">Legal and Security Info</a><button aria-label="Toggle the collapsible sidebar category &#x27;Legal and Security Info&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="../../index.html"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../overview.html"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../../category/web3.html"><span itemprop="name">Web3</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Escrow contract with Solidity</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Build an escrow contract on the Ethereum blockchain with Solidity and Replit</h1><p>Since Satoshi Nakamoto released the first version of Bitcoin in early 2009, digital currencies and blockchain technology have been the site of frenzied innovation, excitement and speculation. In addition to Bitcoin itself, hundreds of competing and complementary blockchains and currencies have come and gone. In this tutorial, we will be looking at Ethereum, the second most popular and widely used cryptocurrency after Bitcoin.</p><p>Ethereum&#x27;s main innovation is to provide a Turing complete environment for on-chain computation, which means we can run code on the blockchain. This opens up an immense field of possibilities for creating decentralized finance (DeFi) platforms, which can act as open alternatives to traditional financial services such as loans, investment, insurance and the sale of artworks.</p><p>In this tutorial, we will be building a simple escrow smart contract, which will include deploying our own <a href="https://en.wikipedia.org/wiki/Non-fungible_token" target="_blank" rel="noopener noreferrer">non-fungible token</a> (NFT). By the end of this tutorial, you will:</p><ul><li>Have experience with developing Ethereum smart contracts using the Solidity programming language.</li><li>Know the basics of deploying contracts to a blockchain and interacting with them.</li><li>Have an understanding of some of the key considerations for secure blockchain development.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="getting-started">Getting started<a href="escrow-contract-with-solidity.html#getting-started" class="hash-link" aria-label="Direct link to Getting started" title="Direct link to Getting started">​</a></h2><p>We need two things to get started with this project: a Solidity repl and a browser wallet.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solidity-repl">Solidity repl<a href="escrow-contract-with-solidity.html#solidity-repl" class="hash-link" aria-label="Direct link to Solidity repl" title="Direct link to Solidity repl">​</a></h3><p>Sign in to <a href="https://replit.com/" target="_blank" rel="noopener noreferrer">Replit</a> or <a href="https://replit.com/signup" target="_blank" rel="noopener noreferrer">create an account</a> if you haven&#x27;t already. Once logged in, create a Solidity starter repl.</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/33-escrow-solidity/solidity-starter-repl.png" alt="Create a solidity repl" class="img_ev3q"></p><p>The Solidity starter repl works a little differently from other repls you may have used in the past. Rather than running our repl every time we want to test out a new piece of code, we can run our repl once, to start it up, and it will automatically reload when changes are made to our Solidity code in <code>contract.sol</code>.</p><p>The Solidity starter repl comes with a friendly web interface, built using the <a href="https://web3js.readthedocs.io/en/v1.5.2/" target="_blank" rel="noopener noreferrer">web3 Ethereum JavaScript API</a>, which we will use to deploy and interact with our contracts. We will deploy to Replit&#x27;s testnet, a custom version of the Ethereum blockchain managed by Replit and optimised for testing.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="browser-wallet">Browser wallet<a href="escrow-contract-with-solidity.html#browser-wallet" class="hash-link" aria-label="Direct link to Browser wallet" title="Direct link to Browser wallet">​</a></h3><p>We will need a browser-based web3 wallet to interact with the Replit testnet and our deployed contracts. MetaMask is a popular and feature-rich wallet implemented as a WebExtension. You can install it from <a href="https://metamask.io/download.html" target="_blank" rel="noopener noreferrer">MetaMask&#x27;s download page</a>. Make sure you&#x27;re using a supported browser -- either Chrome, Firefox, Brave or Edge.</p><p>Once you&#x27;ve installed MetaMask, follow the prompts to create a wallet and sign in. MetaMask will give you a 12-word <em>secret recovery phrase</em> -- this is your wallet&#x27;s private key, and must be kept safe and secret. If you lose this phrase, you will not be able to access your wallet, and if someone else finds it, they will.</p><p>If you&#x27;re already using MetaMask, we recommend creating a new account for testing with Replit. You can do this from the account menu, which appears when you click on the account avatar in the top right corner of MetaMask interface.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction-to-smart-contract-development">Introduction to smart contract development<a href="escrow-contract-with-solidity.html#introduction-to-smart-contract-development" class="hash-link" aria-label="Direct link to Introduction to smart contract development" title="Direct link to Introduction to smart contract development">​</a></h2><p>Now that we&#x27;ve got our repl and wallet set up, we can start developing. We will be writing contracts, which are the basic building blocks of Ethereum programs. An individual contract can have state variables and functions, and can inherit from multiple other contracts. Contracts in Solidity are equivalent to classes in a language like Python or Java.</p><p>Contracts on Ethereum and Ethereum-based networks (such as the Replit testnet and Binance Chain) are compiled to bytecode which runs on the <a href="https://ethereum.org/en/developers/docs/evm/" target="_blank" rel="noopener noreferrer">Ethereum Virtual Machine</a> (EVM). This is similar to how Java code compiles to bytecode for the JVM.</p><p>A list of opcodes for EVM is provided <a href="https://ethervm.io/" target="_blank" rel="noopener noreferrer">here</a>. Many of the opcodes dealing with arithmetic and logical operations should be familiar if you&#x27;ve worked with any kind of assembly before. The EVM also has opcodes for blockchain-specific operations, such as getting information about the current block or chain.</p><p>An additional consideration, unique to blockchain development, is that each opcode has an associated price (<a href="https://docs.google.com/spreadsheets/d/1n6mRqkBz3iWcOlRem_mO09GtSKEKrAsfO7Frgx18pNU/edit#gid=0" target="_blank" rel="noopener noreferrer">listed here</a>). Users of smart contracts pay a fee (known as <a href="https://www.investopedia.com/terms/g/gas-ethereum.asp" target="_blank" rel="noopener noreferrer">gas</a>) to invoke state-changing functions. This fee is determined by the opcodes used, and so it is in the interest of developers to keep their code as simple as possible.</p><p>Solidity, which we will be using below, is the most popular language for developing smart contracts on Ethereum. Alternatives such as <a href="https://vyper.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">Vyper</a> exist, but are not as widely used.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="escrow-protocol-design">Escrow protocol design<a href="escrow-contract-with-solidity.html#escrow-protocol-design" class="hash-link" aria-label="Direct link to Escrow protocol design" title="Direct link to Escrow protocol design">​</a></h2><p>Before we jump into the code, let&#x27;s make sure we have a plan for what we&#x27;re going to build.</p><p>An <a href="https://www.investopedia.com/terms/e/escrow.asp" target="_blank" rel="noopener noreferrer">escrow</a> is a contractual agreement in which a third party receives money from one party and pays it to another party after a certain condition has been met. In traditional finance, this third party needs to be a trusted individual or organization, such as a bank, but in DeFi, it can be a smart contract.</p><p>We will build a simple escrow protocol that holds funds until a specified duration has passed. This could be used to give a friend some Ethereum for their birthday, or to save money for a specific occasion.</p><p>Our escrow protocol will consist of two contracts:</p><ul><li><code>Escrow</code>, which will provide the end-user interface for escrowing and redeeming funds. This contract will also store all of the escrowed funds.</li><li><code>EscrowNFT</code>, which will store the details of individual escrows as NFTs. This will allow users to transfer immature escrows between one another.</li></ul><p>While the most famous use of NFTs involves buying and selling artworks and other collectibles on marketplaces like <a href="https://opensea.io/" target="_blank" rel="noopener noreferrer">OpenSea</a>, we can use them for all kinds of other purposes, such as to represent escrows.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="escrow-nft">Escrow NFT<a href="escrow-contract-with-solidity.html#escrow-nft" class="hash-link" aria-label="Direct link to Escrow NFT" title="Direct link to Escrow NFT">​</a></h2><p>Let&#x27;s start coding with the EscrowNFT contract. Open <code>contract.sol</code>, delete the file&#x27;s contents, and add the following:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SPDX-License-Identifier: MIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pragma solidity ^0.8.2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@openzeppelin/contracts/access/Ownable.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contract EscrowNFT is ERC721Burnable, ERC721Enumerable, Ownable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 public tokenCounter = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // NFT data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapping(uint256 =&gt; uint256) public amount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapping(uint256 =&gt; uint256) public matureTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constructor() ERC721(&quot;EscrowNFT&quot;, &quot;ESCRW&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first line of our contract is the <a href="https://docs.soliditylang.org/en/v0.6.8/layout-of-source-files.html#spdx-license-identifier" target="_blank" rel="noopener noreferrer">license identifier</a>. Smart contracts are usually open source, and reuse of other projects&#x27; code is common in DeFi, so it&#x27;s a good idea to include a license that indicates how you would like others to use (or not use) your code. Supported licenses are listed <a href="https://spdx.org/licenses/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>In the next line, we define the version of Solidity we&#x27;re using (in this case, any version newer than <a href="https://docs.soliditylang.org/en/v0.8.2/" target="_blank" rel="noopener noreferrer">0.8.2</a> up to 0.9.0). Solidity is an evolving language and often introduces breaking changes, so our code may not compile under older or newer versions of the language.</p><p>Following the <code>pragma</code> statement, we import some contracts from the <a href="https://openzeppelin.com/contracts/" target="_blank" rel="noopener noreferrer">OpenZeppelin contract library</a>. This library includes inheritable base contracts for a wide variety of common smart contract development needs, including base implementations of Ethereum token standards.</p><p>The Ethereum token standard for NFTs is <a href="https://ethereum.org/en/developers/docs/standards/tokens/erc-721/" target="_blank" rel="noopener noreferrer">ERC-721</a>. Rather than implementing it ourselves, we can import and use OpenZeppelin&#x27;s version. Note that while OpenZeppelin has a <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/ERC721.sol" target="_blank" rel="noopener noreferrer">base <code>ERC721</code> contract</a>, we will use a couple of extensions:</p><ul><li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/extensions/ERC721Burnable.sol" target="_blank" rel="noopener noreferrer"><code>ERC721Burnable</code></a>, which will allow us to destroy NFTs that have been redeemed.</li><li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/extensions/ERC721Enumerable.sol" target="_blank" rel="noopener noreferrer"><code>ERC721Enumerable</code></a>, which will allow us to list which NFTs belong to which owners.</li></ul><p>Both of these extension contracts inherit from <code>ERC721</code>.</p><p>We also use OpenZeppelin&#x27;s <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol" target="_blank" rel="noopener noreferrer"><code>Ownable</code></a> contract, which will allow us to enforce access control on sensitive functionality.</p><p>As Solidity supports <a href="https://docs.soliditylang.org/en/v0.8.2/contracts.html#inheritance" target="_blank" rel="noopener noreferrer">multiple inheritance</a>, the contract definition line uses all of our imports:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract EscrowNFT is ERC721Burnable, ERC721Enumerable, Ownable {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the contract body, we define a few state variables:</p><ul><li><code>tokenCounter</code>: this will provide us with unique, incrementing IDs for tokens as they are minted.</li><li><code>amount</code> and <code>matureTime</code>: these <a href="https://docs.soliditylang.org/en/v0.8.2/types.html#mapping-types" target="_blank" rel="noopener noreferrer">mappings</a> will store data for each token we mint.</li></ul><p>Note the use of <a href="https://docs.soliditylang.org/en/v0.8.2/types.html#integers" target="_blank" rel="noopener noreferrer"><code>uint256</code></a> as the type for these values: because most of the values we deal with in Solidity programs are monetary, we use unsigned integers to avoid storing negative numbers. In versions of Solidity prior to 0.8.0, this sometimes led to dangerous <a href="https://dasp.co/#item-3" target="_blank" rel="noopener noreferrer">overflows</a>, but <a href="https://docs.soliditylang.org/en/v0.8.0/080-breaking-changes.html" target="_blank" rel="noopener noreferrer">overflow protection is now built into the language</a>.</p><p>We do not need to initialize any of these variables, as Solidity will automatically set uninitialized variables to 0.</p><p>The final part of the code we added above is the <code>constructor()</code> method, which calls <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/ERC721.sol#L44" target="_blank" rel="noopener noreferrer">a parent constructor</a> to define our NFT&#x27;s name and symbol/stock ticker.</p><p>Now we need to define a mint function, so that we can create NFTs. We&#x27;ll start with the function definition, which we will add just below the body of <code>constructor()</code>:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function mint(address _recipient, uint256 _amount, uint256 _matureTime) public onlyOwner returns (uint256) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;re defining a function named <code>mint</code> which takes three arguments:</p><ul><li><code>address _recipient</code>: The <a href="https://docs.soliditylang.org/en/v0.8.2/types.html#address" target="_blank" rel="noopener noreferrer">address</a> we will send the NFT to. This can be a user&#x27;s wallet or another contract.</li><li><code>uint256 _amount</code>: The amount of Ether escrowed by this NFT.</li><li><code>uint256 _matureTime</code>: The time (represented as a <a href="https://www.unixtimestamp.com/" target="_blank" rel="noopener noreferrer">Unix Timestamp</a>) at which the NFT&#x27;s funds will be redeemable.</li></ul><p>This function will return a single <code>uint256</code> -- the numeric ID of the minted NFT.</p><p>This is a <code>public</code> function, which means it can be called by both external users and by other functions in this contract, or any contracts that inherit from it. Solidity provides granular function and variable visibility options, which are <a href="https://bitsofco.de/solidity-function-visibility-explained/" target="_blank" rel="noopener noreferrer">explained here</a>.</p><p>Finally, <code>onlyOwner</code> refers to a <a href="https://docs.soliditylang.org/en/v0.8.9/contracts.html#function-modifiers" target="_blank" rel="noopener noreferrer">modifier</a> defined in <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol#L42" target="_blank" rel="noopener noreferrer"><code>Ownable</code></a>. Modifiers are generally used to restrict functions for purposes of access control or state logic. This modifier will ensure that only the owner of the NFT contract is allowed to mint NFTs.</p><p>Now that we&#x27;ve read and understood the function definition, let&#x27;s add the function body:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function mint(address _recipient, uint256 _amount, uint256 _matureTime) public onlyOwner returns (uint256) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _mint(_recipient, tokenCounter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // set values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        amount[tokenCounter] = _amount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        matureTime[tokenCounter] = _matureTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // increment counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenCounter++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return tokenCounter - 1; // return ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we use <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/ERC721.sol#L280" target="_blank" rel="noopener noreferrer"><code>ERC721</code>&#x27;s internal <code>_mint()</code> function</a> to mint a new token to the recipient with the current value of <code>tokenCounter</code> as its ID. We then set the <code>amount</code> and <code>matureTime</code> mappings for our new token. Finally, we increment <code>tokenCounter</code> and return the ID of our token.</p><p>Next, we need to make a function that will return the details of a given token. Add the following code below the body of the <code>mint()</code> function:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function tokenDetails(uint256 _tokenId) public view returns (uint256, uint256) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(_exists(_tokenId), &quot;EscrowNFT: Query for nonexistent token&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (amount[_tokenId], matureTime[_tokenId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We declare this as a <a href="https://docs.soliditylang.org/en/v0.8.2/contracts.html#view-functions" target="_blank" rel="noopener noreferrer"><code>view</code> function</a>. This declaration asserts that the function does not modify state, and thus its invocation does not need to be recorded on-chain. This means it will be callable for free.</p><p>Our function body starts with a <a href="https://docs.soliditylang.org/en/v0.8.2/contracts.html#view-functions" target="_blank" rel="noopener noreferrer"><code>require</code> statement</a>. This is an error-handling function in Solidity: if the condition in the first argument is not met, the current transaction will revert (undoing all previous actions) and the error message in the second argument will be displayed.</p><p>If invoked with an existing token ID, this function will return two <code>uint256</code> values, the <code>amount</code> and <code>matureTime</code> for that ID. Note the syntax for <a href="https://docs.soliditylang.org/en/v0.8.2/contracts.html#returning-multiple-values" target="_blank" rel="noopener noreferrer">multiple return</a>.</p><p>We&#x27;re almost done with our NFT contract! Before we move on, we need to add a few boilerplate functions. Add the following code below the body of your <code>tokenDetails()</code> function:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function contractAddress() public view returns (address) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return address(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function _beforeTokenTransfer(address _from, address _to, uint256 _amount) internal override(ERC721, ERC721Enumerable) { }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function supportsInterface(bytes4 _interfaceId) public view virtual override(ERC721, ERC721Enumerable) returns (bool) { }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our first function will return the contract&#x27;s address. This will make it easier to work with in the Replit web interface.</p><p>The last two functions resolve ambiguities introduced by Solidity&#x27;s multiple inheritance. Because we&#x27;re using two different ERC-721 extensions, the base <code>ERC721</code> contract is inherited twice with different functions added and overridden. To resolve the compiler&#x27;s confusion, we specify that the versions of <code>_beforeTokenTransfer()</code> and <code>supportsInterface()</code> provided by <code>ERC721Enumerable</code> should be preferred.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="escrow-contract">Escrow contract<a href="escrow-contract-with-solidity.html#escrow-contract" class="hash-link" aria-label="Direct link to Escrow contract" title="Direct link to Escrow contract">​</a></h2><p>Now we need to create our Escrow contract, which will act as an interface for creating and redeeming escrows. Add the following <code>contract</code> block to the bottom of <code>contract.sol</code>, below the <code>EscrowNFT</code> contract:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract Escrow is Ownable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EscrowNFT public escrowNFT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool public initialized = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event Escrowed(address _from, address _to, uint256 _amount, uint256 _matureTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event Redeemed(address _recipient, uint256 _amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event Initialized(address _escrowNft);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This contract inherits from <code>Ownable</code>. We define two state variables:</p><ul><li><code>escrowNFT</code>: This is the instance of the <code>EscrowNFT</code> contract that our <code>Escrow</code> contract will use.</li><li><code>initialized</code>: This variable will help us to implement the <a href="https://soliditydeveloper.com/design-pattern-solidity-initialize-contract-after-deployment" target="_blank" rel="noopener noreferrer">initializable design pattern</a>.</li></ul><p>We also define a number of <a href="https://docs.soliditylang.org/en/v0.8.2/contracts.html#events" target="_blank" rel="noopener noreferrer">events</a>. Events provide a user-friendly form of logging on the blockchain and are commonly used by dApps (decentralized apps -- i.e. web frontends for smart contracts). It&#x27;s considered best practice to emit events whenever a state change is made, so we&#x27;ve defined events for our contract&#x27;s three state-changing actions:</p><ul><li>Creation of escrow NFTs.</li><li>Redeeming of escrowed funds.</li><li>Initialization of the contract.</li></ul><p>Let&#x27;s implement initialization now. Add the following code below your event definitions:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    modifier isInitialized() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(initialized, &quot;Contract is not yet initialized&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    function initialize(address _escrowNftAddress) external onlyOwner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(!initialized, &quot;Contract already initialized.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        escrowNFT = EscrowNFT(_escrowNftAddress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initialized = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit Initialized(_escrowNftAddress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we define a custom modifier, <code>isInitialized</code>, which will revert if <code>initialized</code> is false. If <code>initialized</code> is true, the function we apply this modifier to will execute at <code>_</code>.</p><p>Next, we define our <code>initialize()</code> function, which takes a single argument: the address of the <code>EscrowNFT</code> contract to use. We&#x27;ve given this function <code>external</code> visibility, so it can only be called by an external user, and applied the <code>onlyOwner</code> modifier, so only the contract&#x27;s owner can initialize it.</p><p>In the function body, we ensure that the contract is not already initialized, and then we initialize our <code>escrowNFT</code> state variable, set <code>initialized</code> to <code>true</code>, and emit an event.</p><p>Now we need a function that allows us to create escrow NFTs. Add the following code below the <code>initialize</code> function:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function escrowEth(address _recipient, uint256 _duration) external payable isInitialized {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(_recipient != address(0), &quot;Cannot escrow to zero address.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(msg.value &gt; 0, &quot;Cannot escrow 0 ETH.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint256 amount = msg.value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint256 matureTime = block.timestamp + _duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        escrowNFT.mint(_recipient, amount, matureTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit Escrowed(msg.sender,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _recipient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            amount,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            matureTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our <code>escrowEth</code> function is <code>payable</code>, which means it can receive Ether, and it uses the <code>isInitialized</code> modifier. It takes a recipient address and an escrow duration, specified in seconds.</p><p>In the function body, we ensure that the recipient is not the zero address, to prevent users from accidentally minting NFTs without specifying the receiver, and that the amount of Ether to be escrowed (accessible from <a href="https://docs.soliditylang.org/en/v0.8.2/units-and-global-variables.html#block-and-transaction-properties" target="_blank" rel="noopener noreferrer"><code>msg.value</code></a>) is greater than zero.</p><p>We then set the <code>amount</code> and <code>matureTime</code> values for our NFT, using <a href="https://docs.soliditylang.org/en/v0.8.2/units-and-global-variables.html#block-and-transaction-properties" target="_blank" rel="noopener noreferrer"><code>block.timestamp</code></a> to get the current time (approximately). These values are provided to <code>escrowNFT.mint</code>, which will mint our NFT to the specified recipient.</p><p>Finally, we emit an event, using <a href="https://docs.soliditylang.org/en/v0.8.2/units-and-global-variables.html#block-and-transaction-properties" target="_blank" rel="noopener noreferrer"><code>msg.sender</code></a> to retrieve the address of the user who called the function.</p><p>Now that we can create escrow NFTs, we need a way for the recipient to redeem the funds in a matured NFT. Let&#x27;s create a function for that now, below the definition of our <code>escrowEth</code> function:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function redeemEthFromEscrow(uint256 _tokenId) external isInitialized {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(escrowNFT.ownerOf(_tokenId) == msg.sender, &quot;Must own token to claim underlying Eth&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (uint256 amount, uint256 matureTime) = escrowNFT.tokenDetails(_tokenId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(matureTime &lt;= block.timestamp, &quot;Escrow period not expired.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        escrowNFT.burn(_tokenId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (bool success, ) = msg.sender.call{value: amount}(&quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(success, &quot;Transfer failed.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit Redeemed(msg.sender, amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our redemption function first checks whether <code>msg.sender</code> is the owner of the token, to prevent users from attempting to redeem tokens they don&#x27;t own. It then retrieves the <code>amount</code> and <code>matureTime</code> for the specified token ID, and checks whether the <code>matureTime</code> has passed.</p><p>If the token is owned by <code>msg.sender</code> and its <code>matureTime</code> has passed, it is burned using the <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/extensions/ERC721Burnable.sol#L21" target="_blank" rel="noopener noreferrer"><code>burn()</code> function from ERC721Burnable</a>. This destroys the token, ensuring that it cannot be redeemed again.</p><p>Once the token is destroyed, we transfer its underlying Ether to <code>msg.sender</code>. As the creator of the escrow NFT originally paid this amount of Ether into the contract, it should still be available. There are a few different ways of sending Ether in Solidity -- <a href="https://solidity-by-example.org/sending-ether/" target="_blank" rel="noopener noreferrer">using <code>call</code> is the best one</a>. <code>call</code> returns two values, but we only want the first one, so we leave out the second variable declaration in our multiple return syntax.</p><p>If the Ether transfer fails, we revert, undoing the destruction of the token. Otherwise we emit an event to record the escrow redemption.</p><p>Our contract now does the main things it needs to, but we can make some improvements. For example, rather than requiring users to specify the ID of the token they want to redeem, we can create a function that redeems all matured tokens in their possession. Let&#x27;s do this now, by adding a new function beneath the definition of <code>redeemEthFromEscrow</code>:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function redeemAllAvailableEth() external isInitialized {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint256 nftBalance = escrowNFT.balanceOf(msg.sender);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(nftBalance &gt; 0, &quot;No escrow NFTs to redeem.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint256 totalAmount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (uint256 i = 0; i &lt; nftBalance; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            uint256 tokenId = escrowNFT.tokenOfOwnerByIndex(msg.sender, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (uint256 amount, uint256 matureTime) = escrowNFT.tokenDetails(tokenId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (matureTime &lt;= block.timestamp) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                escrowNFT.burn(tokenId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                totalAmount += amount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(totalAmount &gt; 0, &quot;No Ether to redeem.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (bool success, ) = msg.sender.call{value: totalAmount}(&quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        require(success, &quot;Transfer failed.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit Redeemed(msg.sender, totalAmount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We start by querying <code>escrowNFT.balanceOf()</code> to find out the number of escrow NFT tokens <code>msg.sender</code> owns. If they own none, we revert.</p><p>We then create a variable named <code>totalAmount</code> and loop through the user&#x27;s NFTs. We can get the ID for each one using <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/extensions/ERC721Enumerable.sol#L37" target="_blank" rel="noopener noreferrer"><code>tokenOfOwnerByIndex</code></a>, a function defined in <code>ERC721Enumerable</code>. We then retrieve the <code>amount</code> and <code>matureTime</code> for the token using <code>escrowNFT.tokenDetails()</code>. If a given token&#x27;s <code>matureTime</code> has passed, we burn it and add its value to <code>totalAmount</code>.</p><p>Once the for loop has completed, we check whether <code>totalAmount</code> is greater than zero, and revert if it isn&#x27;t. We then send the <code>totalAmount</code> in Ether to <code>msg.sender</code>. At this point, you may wonder why we didn&#x27;t just loop through the user&#x27;s NFTs and called <code>redeem</code> on each one, to avoid repeating code. While this would make our code simpler to read, it would lead to a lot of extra checks and transfers, which would make this function more expensive for users to call. When developing smart contracts, keeping the cost of each function invocation to a minimum is paramount.</p><p>Let&#x27;s add one more function before we deploy our contracts. You should recognize <code>contractAddress()</code> from <code>EscrowNFT</code> above. Add it below the definition of <code>redeemAllAvailableEth()</code>.</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    function contractAddress() public view returns (address) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return address(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And with that, our code is complete!</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="testing-our-protocol">Testing our protocol<a href="escrow-contract-with-solidity.html#testing-our-protocol" class="hash-link" aria-label="Direct link to Testing our protocol" title="Direct link to Testing our protocol">​</a></h2><p>Now that we&#x27;ve written our contracts, it&#x27;s time to deploy them to the Replit testnet and test them out. We&#x27;ll use our repl&#x27;s web interface to do this.</p><p>First, run your repl. Once all of the dependencies are installed, you should see the Replit Ethereum web interface in your repl&#x27;s browser. It looks like this:</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/33-escrow-solidity/replit-eth-web.png" alt="Replit Ethereum web interface" class="img_ev3q"></p><p>Connect your MetaMask wallet to the web interface and switch to the Replit testnet. Then click the link to get 1 ETH for testing. Wait until 1 ETH shows up in your wallet balance on the top right of the page.</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/33-escrow-solidity/switch-to-test.png" alt="Switch to test" class="img_ev3q">
<img loading="lazy" src="https://docimg.replit.com/images/tutorials/33-escrow-solidity/get-one.png" alt="Get one Ether" class="img_ev3q"></p><p>Now you can deploy your contracts. Select &quot;Escrow&quot; from the drop-down box and click <strong>Deploy</strong>. Approve the MetaMask pop-up that appears. Then do the same with &quot;EscrowNFT&quot;.</p><p>Once both of these contracts have been deployed, they will show up as expandable boxes below the drop-down box. Expand both and take a look at all the different functions available.</p><p><img loading="lazy" src="https://docimg.replit.com/images/tutorials/33-escrow-solidity/deployed-contracts.png" alt="Deployed contracts" class="img_ev3q"></p><p>Before we can use either of these contracts, we need to do some setup. First, let&#x27;s initialize <code>Escrow</code>.</p><ol><li>In <code>EscrowNFT</code>, run the view function <code>contractAddress</code>. Click on the output to copy it to your clipboard.</li><li>In <code>Escrow</code>, find the <code>initialize</code> function. Paste the contents of your clipboard into the value for <code>_escrowNftAddress</code>.</li><li>Run the <code>initialize</code> function and confirm the MetaMask pop-up that appears.</li></ol><p>Our <code>Escrow</code> contract is now initialized and linked to <code>EscrowNFT</code>. But before we can use it, there&#x27;s an additional complication. You&#x27;ll recall that we added the <code>onlyOwner</code> modifier to the <code>mint()</code> function in <code>EscrowNFT</code>. When a contract that inherits from <code>Ownable</code> is deployed, its owner is set to the address that deployed it, which will be your wallet address. But we need it to be owned by <code>Escrow</code> so that <code>escrowEth()</code> can call <code>mint()</code>.</p><p>Luckily, <code>Ownable</code> provides functionality for transferring ownership, so we can transfer <code>EscrowNFT</code> to <code>Escrow</code> in the following steps:</p><ol><li>In <code>Escrow</code>, run the view function <code>contractAddress</code>. Click on the output to copy it to your clipboard.</li><li>In <code>EscrowNFT</code>, find the <code>transferOwnership</code> function. Paste the contents of your clipboard into the value for <code>newOwner</code>.</li><li>Run the <code>transferOwnership</code> function and confirm the MetaMask pop-up that appears.</li></ol><p>Now <code>Escrow</code> owns <code>EscrowNFT</code> and our system will work. Let&#x27;s test it out by doing the following:</p><ol><li>Find the <code>escrowEth</code> function in <code>Escrow</code>.</li><li>Specify your own address, a short duration and a small amount of Ether.</li><li>Run the <code>escrowEth</code> function and approve the MetaMask pop-up that appears.</li></ol><p>If you attempt to claim your escrowed Ether using either of the redemption functions in <code>Escrow</code> before the duration has passed, the transaction should fail with the expected error message. However, if you wait for the duration to pass and then call either of the redemption functions, the transaction will fail for a different reason.</p><p>Both redemption functions call <code>EscrowNFT</code>&#x27;s <code>burn()</code> function to burn tokens. This is an access-controlled function, available only to the token owner and addresses approved by the token owner. If this weren&#x27;t the case, anyone could burn any token just by calling the function.</p><p>To allow <code>Escrow</code> to burn our NFT, we need to give it approval. We can do this in the following steps:</p><ol><li>In <code>EscrowNFT</code>, find the <code>setApprovalForAll</code> function.</li><li>Copy the address from <code>Escrow</code>&#x27;s <code>contractAddress</code> function output.</li><li>Paste in the address as the value for <code>operator</code> and specify <code>true</code> as the value for <code>approved</code>.</li><li>Run the <code>setApprovalForAll</code> function and confirm the MetaMask pop-up that appears.</li></ol><p>Once approval is set, you should be able to successfully redeem the escrowed Ether from your mature tokens.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="security-and-trust-considerations-for-smart-contract-development">Security and trust considerations for smart contract development<a href="escrow-contract-with-solidity.html#security-and-trust-considerations-for-smart-contract-development" class="hash-link" aria-label="Direct link to Security and trust considerations for smart contract development" title="Direct link to Security and trust considerations for smart contract development">​</a></h2><p>We&#x27;ve written our escrow system as a way to learn about Solidity development and interacting with smart contracts on the blockchain. To facilitate these outcomes, our contracts make use of a design that is partially insecure and would not be recommended in practice.</p><p>A key part of earning user trust as a smart contract developer is to ensure that you have minimal control over the contracts you deploy. That&#x27;s why, for example, we designed the <code>initialize()</code> function in <code>Escrow</code> to only be callable once. If a contract has a large number of privileged functions that make significant changes to its state and behavior, there is a risk that the owner -- or a hacker who manages to compromise the owner&#x27;s wallet -- will use these functions to steal user funds.</p><p>An unscrupulous developer could create a malicious version of our escrow protocol by doing the following:</p><ol><li>After deploying <code>EscrowNFT</code> but before transferring its ownership, they could call <code>mint()</code> to create an Escrow token with an amount of 100.</li><li>They could then transfer <code>EscrowNFT</code>&#x27;s ownership to <code>Escrow</code>, and wait for users to start paying Ether to <code>Escrow</code> in order to create tokens.</li><li>Once <code>Escrow</code> had a balance of 100 Ether or more, the developer could redeem their token, successfully stealing all user funds.</li><li>Redemption of any subsequent escrow tokens would fail, as the <code>Escrow</code> contract would contain insufficient funds.</li></ol><p>While the evidence of all of this happening would be visible on the blockchain, through events, users may not want or easily be able to look at that information before using the protocol.</p><p>Another, less serious, consideration is that <code>block.timestamp</code> is not always accurate. As this value is derived from when Ethereum miners report it, <a href="https://dasp.co/#item-8" target="_blank" rel="noopener noreferrer">it can be manipulated slightly</a>. This will have a negligible effect on escrow periods of multiple days, weeks or months, but could affect very short escrow periods quite significantly.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-next">What next?<a href="escrow-contract-with-solidity.html#what-next" class="hash-link" aria-label="Direct link to What next?" title="Direct link to What next?">​</a></h2><p>Now that you&#x27;ve got your feet wet with Solidity development, here are some ideas for further development:</p><ul><li>Modify the architecture of the protocol to make it impossible to create a malicious version in the manner described above.</li><li>Create a view function in <code>Escrow</code> that tells the user how much Ether is available for redemption.</li><li>Determine whether the user has approved <code>Escrow</code> before attempting to burn tokens. Add a nice error message if they haven&#x27;t.</li><li>Create an <a href="https://www.investopedia.com/news/what-erc20-and-what-does-it-mean-ethereum/" target="_blank" rel="noopener noreferrer">ERC-20</a> token and allow users to escrow it instead of Ether.</li><li>See if you can rewrite any of the contract functions to use less gas.</li></ul><p>You can find our repl here:</p><iframe height="400px" width="100%" src="https://replit.com/@ritza/Escrow?embed=true" scrolling="no" frameborder="no" allowtransparency="true" allowfullscreen="true" sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-modals"></iframe></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="flexer_Eq2A prev_vqcT"><a class="link_ZrPi" href="build-smart-contract-oracle.html"><span>&lt; Previous<!-- -->: <!-- -->Smart contract oracle with Solidity</span></a></div><div class="flexer_Eq2A"><a class="link_ZrPi" href="../../category/html-css-and-js.html"><span>Next<!-- -->: <!-- -->HTML, CSS, and JS<!-- --> &gt;</span></a></div></nav><footer class="theme-doc-footer docusaurus-mt-lg footer_cxLd"><div class="docs-rating-wrapper"><div class="docs-rating-widget"><span class="helpfulness-indication">Was this helpful?</span><div class="docs-rating-button-wrapper"><button><span>👎</span></button><button><span>👍</span></button></div></div></div><div class="theme-doc-footer-edit-meta-row row editDocContainer_Wpgd"><div></div><div style="flex-grow:1"></div><div class="lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-31T22:34:37.000Z">Aug 31, 2023</time></b></span></div></div></footer></article></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="escrow-contract-with-solidity.html#getting-started" class="table-of-contents__link toc-highlight">Getting started</a><ul><li><a href="escrow-contract-with-solidity.html#solidity-repl" class="table-of-contents__link toc-highlight">Solidity repl</a></li><li><a href="escrow-contract-with-solidity.html#browser-wallet" class="table-of-contents__link toc-highlight">Browser wallet</a></li></ul></li><li><a href="escrow-contract-with-solidity.html#introduction-to-smart-contract-development" class="table-of-contents__link toc-highlight">Introduction to smart contract development</a></li><li><a href="escrow-contract-with-solidity.html#escrow-protocol-design" class="table-of-contents__link toc-highlight">Escrow protocol design</a></li><li><a href="escrow-contract-with-solidity.html#escrow-nft" class="table-of-contents__link toc-highlight">Escrow NFT</a></li><li><a href="escrow-contract-with-solidity.html#escrow-contract" class="table-of-contents__link toc-highlight">Escrow contract</a></li><li><a href="escrow-contract-with-solidity.html#testing-our-protocol" class="table-of-contents__link toc-highlight">Testing our protocol</a></li><li><a href="escrow-contract-with-solidity.html#security-and-trust-considerations-for-smart-contract-development" class="table-of-contents__link toc-highlight">Security and trust considerations for smart contract development</a></li><li><a href="escrow-contract-with-solidity.html#what-next" class="table-of-contents__link toc-highlight">What next?</a></li></ul></div></div></div></div></main></div></div></div></div>
<script src="../../assets/js/runtime~main.1e833c70.js"></script>
<script src="../../assets/js/main.bcce7b23.js"></script>
</body>
</html>