<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/replit/nix-packaging">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Packaging software with Nix | Replit Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.replit.com/tutorials/replit/nix-packaging"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:image" content="https://pbs.twimg.com/card_img/1622937266980093953/r1yP8OZZ?format=png&amp;name=small"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Packaging software with Nix | Replit Docs"><meta data-rh="true" name="description" content="Replit&#x27;s repls are powered by Nix. Nix is a tool for managing software packages and system configurations. The Nix community also maintains the Nix Packages Collection (Nixpkgs), Nix&#x27;s official package repository. It contains over 50,000 projects. Chances are high that the software you need is already in there! You can search for packages on the NixOS website (DuckDuckGo users can use the !nixpkg bang command)."><meta data-rh="true" property="og:description" content="Replit&#x27;s repls are powered by Nix. Nix is a tool for managing software packages and system configurations. The Nix community also maintains the Nix Packages Collection (Nixpkgs), Nix&#x27;s official package repository. It contains over 50,000 projects. Chances are high that the software you need is already in there! You can search for packages on the NixOS website (DuckDuckGo users can use the !nixpkg bang command)."><link data-rh="true" rel="icon" href="../../image/favicon-2.png"><link data-rh="true" rel="canonical" href="nix-packaging.html"><link data-rh="true" rel="alternate" href="nix-packaging.html" hreflang="en"><link data-rh="true" rel="alternate" href="nix-packaging.html" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="../../updates/rss.xml" title="Replit Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="../../updates/atom.xml" title="Replit Docs Atom Feed">




<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var o=Array.prototype.slice.call(arguments);return o.unshift(t),e.push(o),e}};for(var t=0;t<e.methods.length;t++){var o=e.methods[t];e[o]=e.factory(o)}e.load=function(t,o){var r=document.createElement("script");r.type="text/javascript",r.defer=!0,r.src="https://sp.replit.com/sdk.js/v1/"+t+"/sdk.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n),e._loadOptions=o},e.SNIPPET_VERSION="4.15.3",e.load("dne7BWxTufWARK8acyNrH72I5y7ybaQ7",{integrations:{"Segment.io":{apiHost:"sp.replit.com/v1"}}}),e.page("docs")}}()</script><link rel="stylesheet" href="../../assets/css/styles.2ca24b24.css">
<link rel="preload" href="../../assets/js/runtime~main.01d4cfda.js" as="script">
<link rel="preload" href="../../assets/js/main.495109c2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div class="replit-extension"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="nix-packaging.html#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://replit.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" target="_self" href="../../index.html">Docs</a><a class="navbar__item navbar__link" target="_self" href="../../updates.html">Changelog</a><a class="navbar__item navbar__link" target="_self" href="../../extensions.html">Extensions</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div><div class="navbar__item"><a href="https://replit.com/signup" target="_blank" class="sign-up-button">Sign Up</a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a href="https://replit.com" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_isFc"><img src="../../image/logoLight.png" alt="Replit Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="../../image/logoDark.svg" alt="Replit Logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/getting-started.html">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/the-replit-workspace.html">The Replit Workspace</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Replit Workspace&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/power-ups.html">Power Ups</a><button aria-label="Toggle the collapsible sidebar category &#x27;Power Ups&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/hosting.html">Hosting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hosting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/cycles.html">Cycles</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cycles&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/themes.html">Themes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Themes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/bounties.html">Bounties</a><button aria-label="Toggle the collapsible sidebar category &#x27;Bounties&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/extensions.html">Extensions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extensions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/mobile-app.html">Mobile App</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mobile App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../model-farm/index.html">ModelFarm</a><button aria-label="Toggle the collapsible sidebar category &#x27;ModelFarm&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/organizations.html">Organizations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Organizations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-for-education.html">Teams for Education</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams for Education&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teams-pro.html">Teams Pro</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teams Pro&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="../overview.html">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="../../category/replit--nix.html">Replit &amp; Nix</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit &amp; Nix&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="markdown.html">Using Markdown on Replit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="build-host-company-blog-on-replit-with-hugo-nix.html">Static blog with Nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="excalidraw-with-replit.html">How to use Excalidraw with Replit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="how-to-make-a-replit-template.html">How to make a Replit template</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="import-heroku.html">Import a project from Heroku</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="nix-packaging.html">Packaging software with Nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="playing-audio-replit.html">Playing audio on Replit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="replit-libraries.html">Replit libraries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/python.html">Python</a><button aria-label="Toggle the collapsible sidebar category &#x27;Python&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/nodejs.html">Node.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Node.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/kaboomjs.html">Kaboom.js</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kaboom.js&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/web3.html">Web3</a><button aria-label="Toggle the collapsible sidebar category &#x27;Web3&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/html-css-and-js.html">HTML, CSS, and JS</a><button aria-label="Toggle the collapsible sidebar category &#x27;HTML, CSS, and JS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="../../category/miscellanious.html">Miscellanious</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellanious&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/teaching-curriculum.html">Teaching Curriculum</a><button aria-label="Toggle the collapsible sidebar category &#x27;Teaching Curriculum&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/replit-books.html">Replit Books</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replit Books&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../../category/legal-and-security-info.html">Legal and Security Info</a><button aria-label="Toggle the collapsible sidebar category &#x27;Legal and Security Info&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="../../index.html"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../overview.html"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="../../category/replit--nix.html"><span itemprop="name">Replit &amp; Nix</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Packaging software with Nix</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Packaging software with Nix</h1><p>Replit&#x27;s repls are powered by <a href="https://nixos.org/" target="_blank" rel="noopener noreferrer">Nix</a>. Nix is a tool for managing software packages and system configurations. The Nix community also maintains the <a href="https://github.com/NixOS/nixpkgs" target="_blank" rel="noopener noreferrer">Nix Packages Collection</a> (Nixpkgs), Nix&#x27;s official package repository. It contains <a href="https://repology.org/repository/nix_stable" target="_blank" rel="noopener noreferrer">over 50,000 projects</a>. Chances are high that the software you need is already in there! You can search for packages on the <a href="https://search.nixos.org/packages" target="_blank" rel="noopener noreferrer">NixOS website</a> (DuckDuckGo users can use the <a href="https://duckduckgo.com/bang?q=nixpkg" target="_blank" rel="noopener noreferrer"><code>!nixpkg</code> bang command</a>).</p><p>However, despite being the largest repository of packaged software (at the <span title="July 2022">time of writing</span>), there is software that has not been packaged in the Nix Package Set. If you need something packaged in order to use it in Nix, you can <a href="https://github.com/NixOS/nixpkgs/issues/new?labels=0.kind%3A+packaging+request&amp;template=packaging_request.md" target="_blank" rel="noopener noreferrer">make a packaging request</a>, but then you have to wait for a volunteer to package it for you. It&#x27;s much quicker to learn how to package it yourself!</p><p>Packaging software with Nix is easier than for most other repositories. The Nix language is a <abbr title="Domain Specific Language">DSL</abbr> specifically designed for packaging software. It&#x27;s partly why Nixpkgs has the most packages despite having only about a sixth of the maintainers of the repository with the most maintainers, <abbr title="Arch User Repository">AUR</abbr> (2182 vs 12292).</p><p>An exhaustive breakdown of all the ins and outs of packaging for Nix is out of the scope of this article, but we&#x27;ll take a look at the principles of packaging software and show you how to package some simple examples.</p><p>To begin with, let&#x27;s talk about fetching software. Before we can package anything, we need to get a copy of it.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fetching-software">Fetching software<a href="nix-packaging.html#fetching-software" class="hash-link" aria-label="Direct link to Fetching software" title="Direct link to Fetching software">​</a></h2><p>Before we can build a package, we need to fetch either the source code, or if the source code is not available, the binary file. Nix has <a href="https://nixos.org/manual/nixpkgs/stable/#chap-pkgs-fetchers" target="_blank" rel="noopener noreferrer">many different fetchers</a> we can use to fetch files.</p><p>Nix tries hard to be reproducible, that is, to ensure that whenever you build a package with the same inputs, it gives you the exact same result. When we&#x27;re fetching things from the network, we need to be sure that what we&#x27;ve received is the thing we expected. That&#x27;s why Nix fetchers all require you to supply a hash of the expected file. A hash is a short, distinctive representation of some data. It&#x27;s like a digital fingerprint. If the hash of the file we downloaded matches the hash we expected, we can be sure we got the exact file we expected. Nix supports <code>md5</code>, <code>sha1</code>, <code>sha256</code>, and <code>sha512</code> hashes, though the first two are deprecated and should no longer be used.</p><p>How do you get the hash of the file? Some projects will list hashes or checksums of their downloads on their website. If they do, use what they give you. If not, you could download it yourself, and then run a program like <code>sha256sum</code> to get the hash. This works well for simple files, but becomes a bit harder when you&#x27;re using a fetcher like <code>fetchFromGitHub</code> to fetch a specific version of a Git repository. An easy workaround is to fill in a nonsensical value for the hash, and then attempt to build the package. Nix will abort the build after fetching because the hash won&#x27;t match, but it will print the hash of what it fetched to the console. You can copy this value and use it as the correct hash. Re-running the build should now succeed.</p><p>Alternatively, there are also some command-line tools that can prefetch a file for you. They will fetch the file, put it in the Nix store, and print out the hash to the console. The <a href="https://nixos.org/manual/nix/stable/command-ref/nix-prefetch-url.html" target="_blank" rel="noopener noreferrer"><code>nix-prefetch-url</code></a> command comes installed in a standard Nix environment, including Replit repls. Both <code>nix-prefetch-git</code> and <code>nix-prefetch-github</code> are in Nixpkgs (so they can be installed easily using <code>replit.nix</code>) and work similarly. For more advanced uses, consider using <a href="https://github.com/msteen/nix-prefetch" target="_blank" rel="noopener noreferrer"><code>nix-prefetch</code></a>, also in Nixpkgs, which can prefetch using any Nix fetcher.</p><p>When updating the version of something that&#x27;s fetched, be sure to change the hash, too. Internally, Nix uses the hashes to identify things, and if it hasn&#x27;t changed and Nix has already got a copy downloaded from before, Nix may silently use that instead of actually attempting to fetch the file again.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fetch-files-and-archives-with-fetchurl-and-fetchzip">Fetch files and archives with <code>fetchurl</code> and <code>fetchzip</code><a href="nix-packaging.html#fetch-files-and-archives-with-fetchurl-and-fetchzip" class="hash-link" aria-label="Direct link to fetch-files-and-archives-with-fetchurl-and-fetchzip" title="Direct link to fetch-files-and-archives-with-fetchurl-and-fetchzip">​</a></h3><p>The simplest fetcher is <code>fetchurl</code>. It will fetch a file and put it in the Nix store. The <code>fetchzip</code> fetcher is very similar, but it will unpack the archive before storing it in the Nix store. This is useful if you need to refer to specific files from the archive, rather than the download as a whole. Despite its name, it can handle many different archive formats, not just zip files. In general, unless you need to refer to a specific file in an archive in a Nix expression, use <code>fetchurl</code>, which will not unpack the archive before putting it in the Nix store. This will save space, and, as we will cover in more detail later, archives are automatically unpacked during the build process in any case.</p><p>Sign in to <a href="https://replit.com" target="_blank" rel="noopener noreferrer">Replit</a> or <a href="https://replit.com/signup" target="_blank" rel="noopener noreferrer">create an account</a> if you haven&#x27;t already. Once logged in, create a new <a href="https://replit.com/@replit/Blank-Repl" target="_blank" rel="noopener noreferrer">Blank Repl</a>.</p><p><img loading="lazy" src="https://replit-docs-images.bardia.repl.co/images/tutorials/nix-packaging/create-repl.png" alt="Create repl" class="img_ev3q"></p><p>Find the <code>replit.nix</code> file in your repl. If you don&#x27;t see it in the Files sidebar, select &quot;Show hidden files&quot; from the menu.</p><p><img loading="lazy" src="https://replit-docs-images.bardia.repl.co/images/tutorials/nix-packaging/show-hidden.png" class="img_ev3q"></p><p>Edit <code>replit.nix</code> to look like this:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hello = pkgs.stdenv.mkDerivation rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pname = &quot;hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version = &quot;2.12&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src = pkgs.fetchurl {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;mirror://gnu/hello/hello-${version}.tar.gz&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;1111111111111111111111111111111111111111111111111111&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you&#x27;ve made this change to <code>replit.nix</code>, open the Console tab, and press enter. The output should be similar to:</p><p><img loading="lazy" src="https://replit-docs-images.bardia.repl.co/images/tutorials/nix-packaging/wrong-hash.png" alt="Console output using a wrong hash" class="img_ev3q"></p><p>Nix is telling us what the hash of the file it fetched actually is, in this case: <code>1ayhp9v4m4rdhjmnl2bq3cibrbqqkgjbl3s7yk2nhlh8vj3ay16g</code>. Your output might be different, that just means that you&#x27;re using an updated version of Nixpkgs, so <code>stdenv</code> has been updated; since that&#x27;s a dependency of the derivation that <code>stdenv.mkDerivation</code> produces and since derivation hashes depend on their input derivation hashes, your derivation&#x27;s hash will have changed, too.</p><p>Now that we have the real hash, copy it to the <code>sha256</code> attribute in the derivation, press enter in the console, which will then pick up on the change, and Nix will successfully build the <code>hello</code> package — though it won&#x27;t output anything when it succeeds. The <code>hello</code> command will be added to your environment. If you run it, the <code>hello</code> program just echoes &quot;Hello, world!&quot; to the console. At first glance, that doesn&#x27;t seem like a very useful program, but <a href="https://www.gnu.org/software/hello/manual/html_node/Overview.html" target="_blank" rel="noopener noreferrer">its purpose</a> is actually to help test packaging systems. Now we know ours is working!</p><p><img loading="lazy" src="https://replit-docs-images.bardia.repl.co/images/tutorials/nix-packaging/hello-command.png" alt="Successfully installed hello" class="img_ev3q"></p><p>If you have been paying particularly close attention, you may have spotted that Nix is telling us that two derivations will be built, even though we&#x27;re only asking it to build one. This is because each fetcher actually builds a derivation: the fetched file that&#x27;s added to the Nix store. Nix packages can only depend on things that are in the Nix Store, so in order to build <code>hello</code>, we need its source code to be put in the Nix Store, too. Since we don&#x27;t have it yet, it needs to be &quot;built&quot; first (fetched, in this case). A fetcher is actually a special type of builder.</p><p>We could also have gotten the same hash with <code>nix-prefetch-url</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nix-prefetch-url https://ftpmirror.gnu.org/hello/hello-2.12.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://replit-docs-images.bardia.repl.co/images/tutorials/nix-packaging/prefetch-command.png" alt="Prefetch command" class="img_ev3q"></p><p>You can copy the string <code>1ayhp9v4m4rdhjmnl2bq3cibrbqqkgjbl3s7yk2nhlh8vj3ay16g</code> to the <code>sha256</code> field in the derivation and it will also work (again, your actual hash might be different). Sometimes the hashes are in a different format, but that&#x27;s not a problem. Nix fetchers understand different types of hashes presented in a variety of formats.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="some-notes-on-hashes">Some notes on hashes<a href="nix-packaging.html#some-notes-on-hashes" class="hash-link" aria-label="Direct link to Some notes on hashes" title="Direct link to Some notes on hashes">​</a></h3><p>In our first example, we initially provided a hash that we knew was incorrect in order to have Nix output the correct hash in the hash mismatch error message. Trusting the hash that Nix gives back to us is an approach called <a href="https://en.wikipedia.org/wiki/Trust_on_first_use" target="_blank" rel="noopener noreferrer">trust on first use</a>. We&#x27;re assuming that the file Nix actually fetched is correct. For many purposes, this is fine.</p><p>If you have a real hash, not a dummy hash, in your derivation and you still get this error, carefully try to find out what might have happened, as this means that Nix is telling you that the file it actually fetched is not what you expected. It could be that the download was corrupted due to network problems, in which case re-attempting it later might succeed; or that the target file has actually been changed on the server. This might happen if you&#x27;re trying to download from a URL that does not provide a stable version, or if an attacker has surreptitiously replaced the file. If you&#x27;re unsure, try to determine with a trusted party, such as the publishers of the code, whether everything is OK.</p><p>You may notice that the hash Nix calculates for a file doesn&#x27;t match the hash that <code>sha256sum</code> calculates. They are actually the same hash, but they&#x27;re encoded differently. Most hash tools print out the hash in a hexadecimal (base 16) format, but Nix prefers its own non-standard base 32 format, because it&#x27;s shorter (it&#x27;s base 32, but it doesn&#x27;t use the characters <code>e</code>, <code>o</code>, <code>u</code>, and <code>t</code> to reduce the chances of offensive letter sequences). To convert a base 16 hash to a base 32 hash or vice versa, use <code>nix-hash</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ nix-hash --to-base32 --type sha256 cf04af86dc085268c5f4470fbae49b18afbc221b78096aab842d934a76bad0ab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1ayhp9v4m4rdhjmnl2bq3cibrbqqkgjbl3s7yk2nhlh8vj3ay16g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nix-hash --to-base16 --type sha256 1ayhp9v4m4rdhjmnl2bq3cibrbqqkgjbl3s7yk2nhlh8vj3ay16g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cf04af86dc085268c5f4470fbae49b18afbc221b78096aab842d934a76bad0ab</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You don&#x27;t need to encode hashes in Nix&#x27;s custom base 32 format before using them. The normal base 16 format works just fine.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fetch-git-repositories-with-fetchgit">Fetch Git repositories with <code>fetchgit</code><a href="nix-packaging.html#fetch-git-repositories-with-fetchgit" class="hash-link" aria-label="Direct link to fetch-git-repositories-with-fetchgit" title="Direct link to fetch-git-repositories-with-fetchgit">​</a></h3><p>If the source code you need is in a Git repository, you can use <a href="https://nixos.org/manual/nixpkgs/stable/#fetchgit" target="_blank" rel="noopener noreferrer"><code>fetchgit</code></a>. It expects at least one extra attribute compared to <code>fetchurl</code>, the attribute <code>rev</code>. This can be the full Git commit ID (the <code>sha1</code> hash) or a tag name, like <code>v2.12</code>.</p><p>Try the following <code>replit.nix</code> file:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hello = pkgs.stdenv.mkDerivation rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pname = &quot;hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version = &quot;2.12&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src = pkgs.fetchgit {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;https://github.com/ritza-co/simple-hello-world-demo.git&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rev = &quot;v${version}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;1111111111111111111111111111111111111111111111111111&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once again, after changing <code>replit.nix</code>, open the Console tab, and press enter. The output should be similar to:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Detected change in environment, reloading shell...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nix error: building nix env: exit status 102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Output has been trimmed to the last 20 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">executing builder &#x27;/nix/store/bm7jr70d9ghn5cczb3q0w90apsm05p54-bash-5.1-p8/bin/bash&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">building &#x27;/nix/store/6drp4pmqj67b3ysy88fhawz4fdf2kwkb-simple-hello-world-demo.drv&#x27;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exporting https://github.com/ritza-co/simple-hello-world-demo.git (rev v2.12) into /nix/store/hmmp6c24wg43d9cbslmhgrrccvhhaxac-simple-hello-world-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Initialized empty Git repository in /nix/store/hmmp6c24wg43d9cbslmhgrrccvhhaxac-simple-hello-world-demo/.git/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Enumerating objects: 462, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Counting objects: 100% (462/462), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Compressing objects: 100% (333/333), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote: Total 462 (delta 127), reused 462 (delta 127), pack-reused 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receiving objects: 100% (462/462), 1.09 MiB | 7.15 MiB/s, done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resolving deltas: 100% (127/127), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">From https://github.com/ritza-co/simple-hello-world-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * tag               v2.12      -&gt; FETCH_HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Switched to a new branch &#x27;fetchgit&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">removing `.git&#x27;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hash mismatch in fixed-output derivation &#x27;/nix/store/bj8zf0n8xdfrkj5mndmlhg34ac3pd91l-simple-hello-world-demo&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  wanted: sha256:1111111111111111111111111111111111111111111111111111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  got:    sha256:1mc1vrixpkzkdnvpzn3b01awvha6z7k2dnpai3c6g89in8l1wr70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cannot build derivation &#x27;/nix/store/gw50rkh9d2m4hxiyyldcz6wk0hf76pkx-hello.drv&#x27;: 1 dependencies couldn&#x27;t be built</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error: build of &#x27;/nix/store/gw50rkh9d2m4hxiyyldcz6wk0hf76pkx-hello.drv&#x27; failed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Replacing the <code>sha256</code> in the derivation with <code>1mc1vrixpkzkdnvpzn3b01awvha6z7k2dnpai3c6g89in8l1wr70</code> will allow the build to succeed (your hash might be different, check the <code>got: sha256:</code> line).</p><p>There are also fetchers for other version control repositories, such as <a href="https://nixos.org/manual/nixpkgs/stable/#fetchsvn" target="_blank" rel="noopener noreferrer"><code>fetchsvn</code></a>, <a href="https://nixos.org/manual/nixpkgs/stable/#fetchhg" target="_blank" rel="noopener noreferrer"><code>fetchhg</code></a>, or <a href="https://nixos.org/manual/nixpkgs/stable/#fetchcvs" target="_blank" rel="noopener noreferrer"><code>fetchcvs</code></a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fetch-code-from-github-with-fetchfromgithub">Fetch code from GitHub with <code>fetchFromGitHub</code><a href="nix-packaging.html#fetch-code-from-github-with-fetchfromgithub" class="hash-link" aria-label="Direct link to fetch-code-from-github-with-fetchfromgithub" title="Direct link to fetch-code-from-github-with-fetchfromgithub">​</a></h3><p>The <code>fetchFromGitHub</code> fetcher doesn&#x27;t take a <code>url</code> attribute, instead replacing it with <code>owner</code> and <code>repo</code> attributes.</p><p>Try the following <code>replit.nix</code> file:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hello = pkgs.stdenv.mkDerivation rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pname = &quot;hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version = &quot;2.12&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src = pkgs.fetchFromGitHub {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      owner = &quot;ritza-co&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      repo = &quot;simple-hello-world-demo&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rev = &quot;v${version}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;1111111111111111111111111111111111111111111111111111&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, if you switch to the Console tab and pressing enter, the build will fail because we haven&#x27;t provided the correct hash. Nix will output the correct hash. Use this to get the build to succeed.</p><p>There are also fetchers for other Git forges, such as <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromgitlab" target="_blank" rel="noopener noreferrer"><code>fetchFromGitLab</code></a>, <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfrombitbucket" target="_blank" rel="noopener noreferrer"><code>fetchFromBitbucket</code></a>, or <a href="https://nixos.org/manual/nixpkgs/stable/#fetchfromsavannah" target="_blank" rel="noopener noreferrer"><code>fetchFromSavannah</code></a>. Most work just like <code>fetchFromGitHub</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="building-a-package">Building a package<a href="nix-packaging.html#building-a-package" class="hash-link" aria-label="Direct link to Building a package" title="Direct link to Building a package">​</a></h2><p>Now that we know how to fetch source code, we need to know how to build it into actual software. Our little <code>hello</code> program is built in a stock-standard way, and the default options used by <code>stdenv.mkDerivation</code> are perfect for it. Most software is not quite so simple, and will require us to tweak some of these options.</p><p>For some common types of software, Nix has <a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" target="_blank" rel="noopener noreferrer">dedicated builders</a> that make those types of software easier to build. Some examples are Python programs or C# programs.</p><p>The &quot;standard&quot; builder is <code>stdenv.mkDerivation</code>. The dedicated builders are usually wrappers around <code>stdenv.mkDerivation</code>, so they inherit much from it. If the software you need to build is written in C or you can&#x27;t find a dedicated builder for it, use <code>stdenv.mkDerivation</code> to build it.</p><p>Even if there is a dedicated builder for your software, it&#x27;s probably a good idea to at least read this next section on <code>stdenv.mkDerivation</code> so you understand the fundamentals of building a package in Nix.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="building-with-stdenvmkderivation">Building with <code>stdenv.mkDerivation</code><a href="nix-packaging.html#building-with-stdenvmkderivation" class="hash-link" aria-label="Direct link to building-with-stdenvmkderivation" title="Direct link to building-with-stdenvmkderivation">​</a></h3><p>So far, we&#x27;ve not really explained what a derivation means in Nix. A derivation is an attribute set that tells Nix what it needs to know to build a package.</p><p>It contains information about:</p><ul><li>What other derivations, if any, a derivation depends on;</li><li>What build script to use;</li><li>What platform to build for;</li><li>What arguments and environment variables should be available to the builder; and</li><li>Where Nix should put the results of the build.</li></ul><p>As the final part of evaluating a Nix expression that produces a derivation, Nix will save that derivation attribute set to disk in the Nix store as a <code>.drv</code> file. It represents the build action. Later, in the build phase, Nix will use this <code>.drv</code> file to build the package it describes. If you want to see what one looks like, run the following command in the Console:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nix show-derivation </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">which</span><span class="token variable" style="color:#36acaa"> hello</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will show you <code>hello</code>&#x27;s derivation file, which was used by Nix to build it.</p><p>Before Nix builds a derivation, it will ensure that all the input derivation paths are valid. That is, that those derivations have been built and their outputs exist in the Nix store. If not, it will fetch them from the binary cache, or build those first.</p><p>Nix actually has a built-in function called <code>derivation</code> that produces derivation attribute sets, but we usually use <code>stdenv.mkDerivation</code> instead, which is easier to use. The <code>stdenv.mkDerivation</code> builder is not built into the Nix language itself. It&#x27;s part of Nixpkgs, and evolved over time as the community built more and more packages, incorporating their learnings as useful abstractions.</p><p>The minimum attributes that <code>stdenv.mkDerivation</code> needs are <code>name</code> and <code>src</code>. If <code>name</code> is not provided, it will attempt to construct it from <code>pname</code> + <code>version</code>: <code>&quot;${pname}-${version}&quot;</code>.</p><p>The <code>stdenv.mkDerivation</code> builder automates common build tasks and provides common Unix tools: <code>gcc</code>, <code>coreutils</code>/<code>findutils</code>/<code>diffutils</code>, <code>sed</code>/<code>grep</code>/<code>awk</code>, <code>tar</code>/<code>gzip</code>/<code>bzip2</code>/<code>xz</code>, <code>make</code>, <code>bash</code>, and <code>patch</code>. If your package uses the Unix standard <code>./configure; make; make install</code> build procedure (like our earlier <code>hello</code> example), you don&#x27;t even need to tweak the standard build at all. If <code>stdenv.mkDerivation</code> doesn&#x27;t work automatically, you can easily customize or override the various build phases.</p><p>Let&#x27;s take a look at a more complex derivation:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ pkgs }:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mle = with pkgs; stdenv.mkDerivation rec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pname = &quot;mle&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version = &quot;1.5.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    src = fetchFromGitHub {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      owner = &quot;adsr&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      repo = &quot;mle&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rev = &quot;v${version}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;1nhd00lsx9v12zdmps92magz76c2d8zzln3lxvzl4ng73gbvq3n0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Bug fixes found after v1.5.0 release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    patches = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (fetchpatch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &quot;skip_locale_dep_test.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = &quot;https://github.com/adsr/mle/commit/e4dc4314b02a324701d9ae9873461d34cce041e5.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sha256 = &quot;sha256-j3Z/n+2LqB9vEkWzvRVSOrF6yE+hk6f0dvEsTQ74erw=&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (fetchpatch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name = &quot;fix_input_trail.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = &quot;https://github.com/adsr/mle/commit/bc05ec0eee4143d824010c6688fce526550ed508.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sha256 = &quot;sha256-dM63EBDQfHLAqGZk3C5NtNAv23nCTxXVW8XpLkAeEyQ=&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Fix location of Lua 5.4 header and library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    postPatch = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      substituteInPlace Makefile --replace &quot;-llua5.4&quot; &quot;-llua&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      substituteInPlace mle.h    --replace &quot;&lt;lua5.4/&quot; &quot;&lt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      patchShebangs tests/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Use select(2) instead of poll(2) (poll is returning POLLINVAL on macOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Enable compiler optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CFLAGS = &quot;-DTB_OPT_SELECT -O2&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nativeBuildInputs = [ makeWrapper installShellFiles ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buildInputs = [ pcre uthash lua5_4 ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doCheck = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    installFlags = [ &quot;prefix=${placeholder &quot;out&quot;}&quot; ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    postInstall = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      installManPage mle.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deps = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This was adapted from <a href="https://github.com/adsr/mle" target="_blank" rel="noopener noreferrer">mle</a>&#x27;s <a href="https://github.com/NixOS/nixpkgs/blob/c5edc1d38aaa960a04ad2c675af102debde12462/pkgs/applications/editors/mle/default.nix" target="_blank" rel="noopener noreferrer">derivation in Nixpgks</a>. Let&#x27;s break down some of the new concepts in here.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dependencies">Dependencies<a href="nix-packaging.html#dependencies" class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies">​</a></h4><p>If your software depends on other packages that are not part of the standard environment, you can provide them using the <code>buildInputs</code> attribute as follows:</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkgs.stdenv.mkDerivation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = &quot;foo-1.2.3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  buildInputs = with pkgs; [libbar perl ncurses];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You may also see <code>nativeBuildInputs</code>, which you can think of as being for build-time dependencies, whereas <code>buildInputs</code> is for run-time dependencies. That is an oversimplification, but it&#x27;s a good approximation.</p><p>If you&#x27;re unsure where to put a dependency, use <code>buildInputs</code>. Even if you accidentally put a build-time dependency there, the derivation should still build. It&#x27;s not ideal, but if you&#x27;re just trying to get some software into your repl, it&#x27;ll do just fine.</p><p>There are <a href="https://nixos.org/manual/nixpkgs/stable/#variables-specifying-dependencies" target="_blank" rel="noopener noreferrer">even more ways to specify dependencies</a>, but unless you&#x27;re cross-compiling they&#x27;re unlikely to matter to you.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="patches">Patches<a href="nix-packaging.html#patches" class="hash-link" aria-label="Direct link to Patches" title="Direct link to Patches">​</a></h4><p>One of the great things about Nix is that since it&#x27;s source built, it has first-class support for applying patches to software.</p><div class="language-nix codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nix codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkgs.stdenv.mkDerivation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = &quot;foo-1.2.3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  patches = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (fetchpatch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;https://example.com/patches/001_arches_align.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;0i3qclm2mh98c04rqpx1r4qagd3wpxlkj7lvq0ddpkmr8bm0fh0m&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (fetchpatch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;https://example.com/patches/002_no_remove_static_const.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;0zfjqmjsj0y1kfzxbp29v6nxq5qwgazhb9clqc544sm5zn0bdp8n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (fetchpatch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = &quot;https://example.com/patches/003_64_bit_clean.patch&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sha256 = &quot;0mda9fkaqf2s1xl6vlbkbq20362h3is9dpml9kfmacpbifl4dx3n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Patches are applied in the order that they are listed. They must be in the format accepted by the <code>patch</code> command, and may optionally be compressed using <code>gzip</code>, <code>bzip2</code>, or <code>xz</code>.</p><p>They can be local files, or you can fetch them. Prefer using <code>fetchpatch</code> rather than <code>fetchurl</code> to fetch patches. It works similarly, but it performs normalization on the patches before computing the hash, such as removing comments and unstable parts sometimes added by version control systems that change over time (and which would otherwise cause the hash to change).</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="environment-variables">Environment variables<a href="nix-packaging.html#environment-variables" class="hash-link" aria-label="Direct link to Environment variables" title="Direct link to Environment variables">​</a></h4><p>Any attributes that you set on <code>stdenv.mkDerivation</code> will also be made available in the build environment as environment variables. Be aware that they&#x27;ll be set in all phases if you set them this way.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="build-phases">Build phases<a href="nix-packaging.html#build-phases" class="hash-link" aria-label="Direct link to Build phases" title="Direct link to Build phases">​</a></h3><p>The standard builder script has several phases, which are defined as bash functions. You can influence the behaviour of each phase by setting specific attributes on <code>stdenv.mkDerivation</code>, some of which are detailed below. The most common phases are as follows, in order:</p><ol><li><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-unpack-phase" target="_blank" rel="noopener noreferrer"><code>unpackPhase</code></a>: This should unpack the source into the current directory. The default implementation simply unpacks the derivation&#x27;s <code>src</code> files.<ul><li>By default it supports plain tar archives, or those compressed by gzip (<code>*.tar.gz</code>, <code>*.tgz</code> or <code>*.tar.Z</code>), bzip2 (<code>*.tar.bz2</code>, <code>*.tbz2</code> or <code>*.tbz</code>) or xz (<code>*.tar.xz</code>, <code>*.tar.lzma</code> or <code>*.txz</code>).</li><li>It can also automatically unpack zip files. Zip files are unpacked using the <code>unzip</code> package, which is not in the standard environment. Add it to <code>nativeBuildInputs</code>.</li><li>Setting <code>dontUnpack</code> to <code>true</code> will skip this phase.</li></ul></li><li><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-patch-phase" target="_blank" rel="noopener noreferrer"><code>patchPhase</code></a>: The patch phase applies any supplied <code>patches</code> to the unpacked source code.<ul><li><code>patchFlags</code> sets flags to be passed to <code>patch</code>. If not set, the argument <code>-p1</code> is used, which causes the leading directory component to be stripped from the file names in each patch.</li><li>Setting <code>dontPatch</code> to <code>true</code> skips this phase, but if <code>patches</code> is not set it&#x27;s also skipped.</li></ul></li><li><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-configure-phase" target="_blank" rel="noopener noreferrer"><code>configurePhase</code></a>: Prepares the source tree for building. By default, it runs <code>./configure</code> if it exists.<ul><li>Set <code>configureScript</code> to change the configure script. Defaults to <code>./configure</code>.</li><li>Set <code>configureFlags</code> to pass additional arguments to the configure script.</li><li>By default, <code>--prefix=$prefix</code> is added to the configure flags. Set <code>dontAddPrefix</code> to disable this.</li><li>Set <code>prefix</code> to set the <code>$prefix</code> variable above (remember how attributes defined here are also exposed as environment variables). By default this is set to <code>$out</code>, which is the output directory that Nix creates for your package in the Nix store.</li><li>Setting <code>dontConfigure</code> to <code>true</code> will skip this phase.</li></ul></li><li><a href="https://nixos.org/manual/nixpkgs/stable/#build-phase" target="_blank" rel="noopener noreferrer"><code>buildPhase</code></a>:<ul><li>Set <code>makeFile</code> to change the name of the MakeFile.</li><li>Set <code>makeFlags</code> to pass additional flags to <code>make</code>.</li><li>Set <code>buildFlags</code> to pass additional flags to <code>make</code>, but only called during the build phase.</li><li>Setting <code>dontBuild</code> to <code>true</code> will skip this phase.</li></ul></li><li><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-install-phase" target="_blank" rel="noopener noreferrer"><code>installPhase</code></a>:<ul><li>Set <code>installFlags</code> to pass additional flags to <code>make</code>, that will only be called during the install phase.</li><li>Remember that <code>makeFlags</code> will also affect this phase.</li><li>Setting <code>dontInstall</code> to <code>true</code> will skip this phase.</li></ul></li></ol><p>You can override any of these phases by setting an attribute with the phase&#x27;s name. It will be executed as a bash script in the standard environment.</p><p>You can also adjust the build by running code before and after each phase. Set at attribute with either <code>pre</code> or <code>post</code> and the phase&#x27;s name (capitalized), e.g. <code>preConfigure</code> or <code>postBuild</code>.</p><p>You can add yet more phases before or after each of these phases, or even reorder them completely. Read the <a href="https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases" target="_blank" rel="noopener noreferrer">documentation for build phases</a> for details on how to do that.</p><p>Here we&#x27;ve covered the basics. Read <a href="https://nixos.org/manual/nixpkgs/stable/#chap-stdenv" target="_blank" rel="noopener noreferrer"><code>stdenv.mkDerivation</code>&#x27;s documentation</a> for more. Remember that this is the basis for the largest software repository, and as such there&#x27;s a lot it is capable of.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="shell-functions-and-utilities">Shell functions and utilities<a href="nix-packaging.html#shell-functions-and-utilities" class="hash-link" aria-label="Direct link to Shell functions and utilities" title="Direct link to Shell functions and utilities">​</a></h3><p>The standard environment also has a few <a href="https://nixos.org/manual/nixpkgs/stable/#ssec-stdenv-functions" target="_blank" rel="noopener noreferrer">shell functions and utilities</a> that may be helpful if you&#x27;re making adjustments to the phases above, such as:</p><ul><li><a href="https://nixos.org/manual/nixpkgs/stable/#fun-substituteInPlace" target="_blank" rel="noopener noreferrer"><code>substituteInPlace</code></a>, which performs substitutions in files, especially handy to replace references in scripts to executables in nix derivations to get them to work correctly:<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">substituteInPlace ./foo.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --replace /usr/bin/bar $bar/bin/bar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --replace /usr/bin/baz $bar/bin/baz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dedicated-builders">Dedicated builders<a href="nix-packaging.html#dedicated-builders" class="hash-link" aria-label="Direct link to Dedicated builders" title="Direct link to Dedicated builders">​</a></h3><p>As we touched on before, <code>stdenv.mkDerivation</code> is not the only builder. Many frameworks, programming languages, or build systems have dedicated builders that provide conveniences and abstractions for their idiosyncrasies. Be sure to have a look at <a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" target="_blank" rel="noopener noreferrer">builders for specific languages and frameworks</a> in the Nixpkgs manual.</p><p>It is not necessarily an exhaustive list. Even if you don&#x27;t see a dedicated builder for your use case listed in the manual, there may still be one. The best way to find out is to have a look at <a href="https://github.com/NixOS/nixpkgs" target="_blank" rel="noopener noreferrer">source code in Nixpkgs</a>, which is hosted on GitHub.</p><p>Look for terms, tools, and commands that are specific to your ecosystem. You can use GitHub&#x27;s web search, or make a local clone of the repo to <code>grep</code> (consider making a shallow clone using git&#x27;s <code>--depth=1</code> flag, as it&#x27;s quite a big repository with many branches and a long history).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="package-setup-hooks">Package setup hooks<a href="nix-packaging.html#package-setup-hooks" class="hash-link" aria-label="Direct link to Package setup hooks" title="Direct link to Package setup hooks">​</a></h3><p><a href="https://nixos.org/manual/nixpkgs/stable/#ssec-setup-hooks" target="_blank" rel="noopener noreferrer">Hooks</a> are scripts that are run during the build if a dependency uses them. If a dependency of your derivation uses a hook, that hook will be run during the build of your derivation.</p><p>You should not use hooks directly, but be aware that depending on packages that use hooks may change the way your build works. Even <code>stdenv.mkDerivation</code> includes some hooks, for example, to place docs in the right place, to remove debug symbols, or to compress man pages.</p><p>There are hooks for specific technologies, for example, the <code>cmake</code> derivation uses the <a href="https://nixos.org/manual/nixpkgs/stable/#cmake" target="_blank" rel="noopener noreferrer"><code>cmake</code> hook</a>, which makes some changes to <code>stdenv.mkDerivation</code> for Cmake projects. Thus, including <code>cmake</code> (the derivation) in the <code>nativeBuildInputs</code> of your derivation will change the way it works. You can use the <code>cmakeFlags</code> attribute in this situation.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="further-reading">Further reading<a href="nix-packaging.html#further-reading" class="hash-link" aria-label="Direct link to Further reading" title="Direct link to Further reading">​</a></h2><p>For more information, be sure to take a look at:</p><ul><li>Nix Pills <a href="https://nixos.org/guides/nix-pills/our-first-derivation.html" target="_blank" rel="noopener noreferrer">6: Our First Derivation</a>, <a href="https://nixos.org/guides/nix-pills/working-derivation.html" target="_blank" rel="noopener noreferrer">7: Working Derivation</a>, and <a href="https://nixos.org/guides/nix-pills/generic-builders.html" target="_blank" rel="noopener noreferrer">8: Generic Builders</a> for a gradual build up to <code>stdenv.mkDerivation</code> from first principles.</li><li>The <a href="https://nixos.org/manual/nixpkgs/stable/" target="_blank" rel="noopener noreferrer">Nixpkgs manual</a>, the authoritative reference, which includes further information, such as advanced features we haven&#x27;t gotten into here. Of particular interest might be the section on <a href="https://nixos.org/manual/nixpkgs/stable/#chap-language-support" target="_blank" rel="noopener noreferrer">trivial builders</a> for creating things like text files or shell scripts.</li><li><a href="https://nixos.wiki/wiki/Packaging/Binaries" target="_blank" rel="noopener noreferrer">Packaging/Binaries on the NixOS Wiki</a>. You may need to use a pre-compiled binary file. This is most common with proprietary software.</li></ul></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="flexer_Eq2A prev_vqcT"><a class="link_ZrPi" href="import-heroku.html"><span>&lt; Previous<!-- -->: <!-- -->Import a project from Heroku</span></a></div><div class="flexer_Eq2A"><a class="link_ZrPi" href="playing-audio-replit.html"><span>Next<!-- -->: <!-- -->Playing audio on Replit<!-- --> &gt;</span></a></div></nav><footer class="theme-doc-footer docusaurus-mt-lg footer_cxLd"><div class="docs-rating-wrapper"><div class="docs-rating-widget"><span class="helpfulness-indication">Was this helpful?</span><div class="docs-rating-button-wrapper"><button><span>👎</span></button><button><span>👍</span></button></div></div></div><div class="theme-doc-footer-edit-meta-row row editDocContainer_Wpgd"><div></div><div style="flex-grow:1"></div><div class="lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-31T22:34:37.000Z">Aug 31, 2023</time></b></span></div></div></footer></article></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="nix-packaging.html#fetching-software" class="table-of-contents__link toc-highlight">Fetching software</a><ul><li><a href="nix-packaging.html#fetch-files-and-archives-with-fetchurl-and-fetchzip" class="table-of-contents__link toc-highlight">Fetch files and archives with <code>fetchurl</code> and <code>fetchzip</code></a></li><li><a href="nix-packaging.html#some-notes-on-hashes" class="table-of-contents__link toc-highlight">Some notes on hashes</a></li><li><a href="nix-packaging.html#fetch-git-repositories-with-fetchgit" class="table-of-contents__link toc-highlight">Fetch Git repositories with <code>fetchgit</code></a></li><li><a href="nix-packaging.html#fetch-code-from-github-with-fetchfromgithub" class="table-of-contents__link toc-highlight">Fetch code from GitHub with <code>fetchFromGitHub</code></a></li></ul></li><li><a href="nix-packaging.html#building-a-package" class="table-of-contents__link toc-highlight">Building a package</a><ul><li><a href="nix-packaging.html#building-with-stdenvmkderivation" class="table-of-contents__link toc-highlight">Building with <code>stdenv.mkDerivation</code></a></li><li><a href="nix-packaging.html#build-phases" class="table-of-contents__link toc-highlight">Build phases</a></li><li><a href="nix-packaging.html#shell-functions-and-utilities" class="table-of-contents__link toc-highlight">Shell functions and utilities</a></li><li><a href="nix-packaging.html#dedicated-builders" class="table-of-contents__link toc-highlight">Dedicated builders</a></li><li><a href="nix-packaging.html#package-setup-hooks" class="table-of-contents__link toc-highlight">Package setup hooks</a></li></ul></li><li><a href="nix-packaging.html#further-reading" class="table-of-contents__link toc-highlight">Further reading</a></li></ul></div></div></div></div></main></div></div></div></div>
<script src="../../assets/js/runtime~main.01d4cfda.js"></script>
<script src="../../assets/js/main.495109c2.js"></script>
</body>
</html>