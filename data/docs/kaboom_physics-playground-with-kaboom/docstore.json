{"docstore/data": {"61a304cb-d78a-4fc8-89ca-7d8a5c13acf2": {"__data__": {"id_": "61a304cb-d78a-4fc8-89ca-7d8a5c13acf2", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "2d49c9b9-fb36-4d36-9757-c488982ad951", "node_type": "1", "metadata": {}, "hash": "4cea596238d6b793592811e326bb222b2bc1bef03838af557c0b05e3b54d8a8a", "class_name": "RelatedNodeInfo"}}, "hash": "1ec914a3b10fa50eb8179568b4dcd40781a277b3971bde4f73a5a14fe1340a89", "text": "CYAN\n\narea\n\nsolid\n\n\"wall\"\n\n\"#\"\n\n=>\n\n// crate\n\nrect\n\n32\n\n32\n\ncolor\n\nRED\n\noutline\n\norigin\n\n\"center\"\n\narea\n\nbody\n\n\"movable\"\n\n\"@\"\n\n=>\n\n// player\n\ncircle\n\n32\n\ncolor\n\nGREEN\n\noutline\n\narea\n\nwidth\n\n64\n\nheight\n\n64\n\nbody\n\norigin\n\n\"center\"\n\nspeed\n\n120\n\njumpspeed\n\n1000\n\n\"player\"\n\nThis code uses Kaboom's addLevel() function to visually construct a level. This function takes two arguments: an ASCII art representation of the level, and a JSON object defining the width and height of individual blocks and providing definitions for each of the objects used. Let's take a closer look at each of these definitions, starting with the wall object.\n\n\"=\"\n\n=>\n\n// wall\n\nrect\n\n32\n\n32\n\ncolor\n\nCYAN\n\narea\n\nsolid\n\n\"wall\"\n\nA game object definition in Kaboom is a list of components and tags, and optionally custom attributes and functions. Components are a core part of Kaboom \u2013 they provide different functionality to game objects, from an object's appearance to functionality such as collision detection.\n\nThis wall object has four components:\n\nrect(), which draws a rectangle to represent the object.\n\ncolor(), which gives the rectangle a color.\n\narea(), which provides collision detection for the object.\n\nsolid(), which will prevent other objects from moving past it.\n\nWe've given the object the tag \"wall\". Objects can have multiple tags, which can be used to define custom behavior, such as collision detection between objects with particular tags.\n\nNext, let's look at the crate definition:\n\n\"#\"\n\n=>\n\n// crate\n\nrect\n\n32\n\n32\n\ncolor\n\nRED\n\noutline\n\norigin\n\n\"center\"\n\narea\n\nbody\n\n\"movable\"\n\nCompared to our wall, we've given our crate the following additional components:\n\nz(), which defines the crate's z-order, ensuring it will be drawn on top of walls.\n\noutline(), which will draw a single-pixel outline around the object.\n\norigin(), which sets the sprite's origin to \"center\", so that we can move it around from its center, rather than the default top-left corner.\n\nbody(), which makes our crate subject to gravity.\n\nWe've given it the tag \"movable\", a generic tag we can use for all objects that can be manipulated by the player's gravity gun.\n\nFinally, let's look at the player object:\n\n\"@\"\n\n=>\n\n// player\n\ncircle\n\n32\n\ncolor\n\nGREEN\n\noutline\n\narea\n\nwidth\n\n64\n\nheight\n\n64\n\nbody\n\norigin\n\n\"center\"\n\nspeed\n\n120\n\njumpspeed\n\n1000\n\n\"player\"\n\nNote the following:\n\nAs we're using the circle component to draw the player, we must specify a width and height for the area() component. All collision areas in Kaboom.js are rectangular (as of v2000.1.6).\n\nWe've added speed and jumpspeed custom variables to the player object, which we'll use to control its movement speed and jump height.\n\nRun your repl now, and you'll see your level, with player, crates and walls. As we've placed the player in mid-air, you should see them fall to the platform below, confirming the presence of gravity.\n\nMoving the player\u200b\n\nLet's write some code to control the player. First, we need to retrieve a reference to the player using get():\n\n// player\n\nplayer\n\nget\n\n\"player\"\n\nNow we'll add code to move the player left and right. As we'll use the mouse to control the player's gravity gun, it makes ergonomic sense to control the player with the WASD keys rather than the arrow keys. Add the following code:\n\nonKeyDown\n\n\"a\"\n\n=>\n\nplayer\n\nmove\n\nplayer\n\nspeed\n\nonKeyDown\n\n\"d\"\n\n=>\n\nplayer\n\nmove\n\nplayer\n\nspeed\n\nHere we detect the onKeyDown event for the A key to move the player to the left and D key to move the player to the right. The move() function automatically checks for collisions with solid objects, so the player will only move if there is space to do so.\n\nonKeyDown\n\n\"w\"\n\n=>\n\nif\n\nplayer\n\nisGrounded\n\nplayer\n\njump\n\nplayer\n\njumpspeed\n\nThe isGrounded() and jump() functions are provided by the body() component, making basic platformer movement simple to implement in Kaboom.\n\nRerun your repl (or refresh your repl's webview) now, and you should be able to move left and right with A and D, and to jump with W. If the player jumps off the platform, they will fall out of view. We can fix this by having the game camera follow the player.", "start_char_idx": 0, "end_char_idx": 4095, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "2d49c9b9-fb36-4d36-9757-c488982ad951": {"__data__": {"id_": "2d49c9b9-fb36-4d36-9757-c488982ad951", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "61a304cb-d78a-4fc8-89ca-7d8a5c13acf2", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "1ec914a3b10fa50eb8179568b4dcd40781a277b3971bde4f73a5a14fe1340a89", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "44afa851-d5ca-4d99-a51f-d42907b1fc46", "node_type": "1", "metadata": {}, "hash": "13a17f5b03f3f0bc8d38b16bb6013e3373bcf05b3e223a3713c156e2fbfa2037", "class_name": "RelatedNodeInfo"}}, "hash": "4cea596238d6b793592811e326bb222b2bc1bef03838af557c0b05e3b54d8a8a", "text": "The move() function automatically checks for collisions with solid objects, so the player will only move if there is space to do so.\n\nonKeyDown\n\n\"w\"\n\n=>\n\nif\n\nplayer\n\nisGrounded\n\nplayer\n\njump\n\nplayer\n\njumpspeed\n\nThe isGrounded() and jump() functions are provided by the body() component, making basic platformer movement simple to implement in Kaboom.\n\nRerun your repl (or refresh your repl's webview) now, and you should be able to move left and right with A and D, and to jump with W. If the player jumps off the platform, they will fall out of view. We can fix this by having the game camera follow the player. Add the following code below your keyboard-handling code:\n\n// camera follow player\n\nplayer\n\nonUpdate\n\n=>\n\ncamPos\n\nplayer\n\npos\n\nThis code will run every frame and keep the camera focused on the player as they move around. Refresh your in-repl browser and try it out.\n\nPulling objects with the gravity gun\u200b\n\nNow that we've got our generic platformer functionality implemented, it's time to add the gravity gun. The player will aim their gravity gun with the mouse. It will have a range, which we'll show as a line. Movable objects that fall into that range will have a thicker outline drawn around them. When the player holds down the right mouse button, objects in range will travel towards them, until they reach the edge of a secondary, \"holding\" range. Objects in the holding range will move with the player until the left mouse button is clicked, at which point they will be launched into the air. Alternatively, the player can click the right mouse button to drop the held object.\n\nIn the code above, we've implemented horizontal movement (walking) and vertical movement (jumping). Implementing our gravity gun will require us to implement movement at arbitrary angles. To this end, we will need to write a couple of helper functions. Go to the top of your file, and add the following code beneath the kaboom(); line:\n\n// helper functions\n\nfunction\n\nangleBetween\n\np1\n\np2\n\nreturn\n\nMath\n\natan2\n\np2\n\np1\n\np2\n\np1\n\nfunction\n\npointAt\n\ndistance\n\nangle\n\nreturn\n\nvec2\n\ndistance\n\nMath\n\ncos\n\nangle\n\ndistance\n\nMath\n\nsin\n\nangle\n\nThe first function, angleBetween(), uses JavaScript's Math.atan2() to determine the angle two points make with the horizontal. The second function, pointAt(), uses sines and cosines to determine the point at a certain distance and angle.\n\nNext, we'll add two custom components:\n\ngravitygun(), which will define attributes and functions for our player's gravity gun.\n\nphysics(), which will define attributes and functions for the movable objects the gravity gun will manipulate.\n\nAdd the following code for the gravitygun() component beneath your helper function definitions:\n\n// custom components\n\nfunction\n\ngravitygun\n\nrange\n\nhold\n\nfirepower\n\nreturn\n\nid\n\n\"gravitygun\"\n\nrequire\n\n\"pos\"\n\nComponents are written as functions that return objects of a specific format. Each component should have an id, and a list of components it depends on attached to the require attribute. Beyond that, components can have arbitrary attributes, which will be assigned to their parent object, and special functions, which will be integrated into the game's event loop.\n\nThe only dependency for our component is pos(), as it will not work on an object that doesn't have a position in the world. Function arguments will allow us to customize this component, in the form of specifying the gravity gun's range, hold distance, and firepower.\n\nLet's add some custom attributes to our component, to help us aim and fire the gravity gun. Expand your component code to match the following:\n\nfunction\n\ngravitygun\n\nrange\n\nhold\n\nfirepower\n\nreturn\n\nid\n\n\"gravitygun\"\n\nrequire\n\n\"pos\"\n\nfirepower\n\nfirepower\n\n// new code from this line\n\nrange\n\nrange\n\nhold\n\nhold\n\naimAngle\n\nangleBetween\n\nthis\n\npos\n\nmouseWorldPos\n\nrangeLine\n\np1\n\nthis\n\npos\n\np2\n\nthis\n\npos\n\ncolor\n\nBLACK\n\nholdLine\n\np1\n\nthis\n\npos\n\np2\n\nthis\n\npos\n\ncolor\n\nBLUE\n\nIn the above code:\n\nfirepower is the amount of force to launch objects with.\n\nrange is the length of our gravity gun's pulling range.\n\nhold is the distance from the player's center at which objects will be held once pulled in.\n\naimAngle is the angle of our gravity gun's aim, which will be the angle created with the horizontal.\n\nrangeLine and holdLine are lines we will use to represent the gravity gun's range and hold.", "start_char_idx": 3483, "end_char_idx": 7821, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "44afa851-d5ca-4d99-a51f-d42907b1fc46": {"__data__": {"id_": "44afa851-d5ca-4d99-a51f-d42907b1fc46", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "2d49c9b9-fb36-4d36-9757-c488982ad951", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "4cea596238d6b793592811e326bb222b2bc1bef03838af557c0b05e3b54d8a8a", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8", "node_type": "1", "metadata": {}, "hash": "a31d41dd89a4681e93e90b5eb48eddfa6a26d29b8fee49cab939bd041d8952b5", "class_name": "RelatedNodeInfo"}}, "hash": "13a17f5b03f3f0bc8d38b16bb6013e3373bcf05b3e223a3713c156e2fbfa2037", "text": "range is the length of our gravity gun's pulling range.\n\nhold is the distance from the player's center at which objects will be held once pulled in.\n\naimAngle is the angle of our gravity gun's aim, which will be the angle created with the horizontal.\n\nrangeLine and holdLine are lines we will use to represent the gravity gun's range and hold.\n\nNow we need to add a draw() function to draw both lines, and an update() function to recalculate the gravity gun's aim angle and the position of both lines as the mouse cursor moves around. Alter your component code to include these functions at the bottom:\n\nfunction\n\ngravitygun\n\nrange\n\nhold\n\nfirepower\n\nreturn\n\nid\n\n\"gravitygun\"\n\nrequire\n\n\"pos\"\n\nfirepower\n\nfirepower\n\nrange\n\nrange\n\nhold\n\nhold\n\naimAngle\n\nangleBetween\n\nthis\n\npos\n\nmouseWorldPos\n\nrangeLine\n\np1\n\nthis\n\npos\n\np2\n\nthis\n\npos\n\ncolor\n\nBLACK\n\nholdLine\n\np1\n\nthis\n\npos\n\np2\n\nthis\n\npos\n\ncolor\n\nBLUE\n\ndraw\n\n// new code from this line\n\ndrawLine\n\nthis\n\nrangeLine\n\ndrawLine\n\nthis\n\nholdLine\n\nupdate\n\nthis\n\naimAngle\n\nangleBetween\n\nthis\n\npos\n\nmouseWorldPos\n\nthis\n\nrangeLine\n\np1\n\nthis\n\npos\n\nthis\n\nrangeLine\n\np2\n\nthis\n\npos\n\nadd\n\npointAt\n\nthis\n\nrange\n\nthis\n\naimAngle\n\nthis\n\nholdLine\n\np1\n\nthis\n\npos\n\nthis\n\nholdLine\n\np2\n\nthis\n\npos\n\nadd\n\npointAt\n\nthis\n\nhold\n\nthis\n\naimAngle\n\nOur gravity gun component is complete. Now we need to add the physics() component, for objects affected by the gravity gun. Add the following code just below the last code you added:\n\nfunction\n\nphysics\n\nmass\n\nreturn\n\nid\n\n\"physics\"\n\nrequire\n\n\"area\"\n\n\"body\"\n\nmass\n\nmass\n\ninRange\n\nfalse\n\ninHold\n\nfalse\n\nheld\n\nfalse\n\ndropping\n\nfalse\n\ndirection\n\nspeed\n\ndraw\n\nif\n\nthis\n\ninRange\n\ndrawRect\n\nwidth\n\nthis\n\nwidth\n\nheight\n\nthis\n\nheight\n\npos\n\nvec2\n\nthis\n\npos\n\nthis\n\nwidth\n\nthis\n\npos\n\nthis\n\nheight\n\nopacity\n\noutline\n\ncolor\n\nBLACK\n\nwidth\n\nThis component requires both area and body \u2013 to be affected by the gravity gun, objects must have a collision area and be subject to regular gravity. We also give our physics objects a mass, direction and speed, and several variables to aid the gravity gun. Finally, we define a draw() function, which will draw a thick rectangle around the object when it is in gravity gun range.\n\nNow we need to add the gravitygun() component to the player object and the physics() component to the crate object. Find your level creation code and add the new component lines to the objects as below:\n\n\"#\"\n\n=>\n\n// crate\n\nrect\n\n32\n\n32\n\ncolor\n\nRED\n\noutline\n\norigin\n\n\"center\"\n\narea\n\nbody\n\nphysics\n\n100\n\n// <-- NEW LINE\n\n\"movable\"\n\n\"@\"\n\n=>\n\ncircle\n\n32\n\ncolor\n\nGREEN\n\noutline\n\narea\n\nwidth\n\n64\n\nheight\n\n64\n\nbody\n\norigin\n\n\"center\"\n\ngravitygun\n\n150\n\n55\n\n40\n\n// <-- NEW LINE\n\nspeed\n\n120\n\njumpspeed\n\n1000\n\n\"player\"\n\nWe now have everything in place to write the code that will allow us to pull objects with the gravity gun. We'll do this in an onUpdate() event callback for objects with the \"movable\" tag. Add the following code to the bottom of the main.js file:\n\n// gravity gun pull and hold\n\nonUpdate\n\n\"movable\"\n\nmovable\n\n=>\n\n// test collisions\n\nmyRect\n\nmovable\n\nworldArea\n\nmovable\n\ninRange\n\ntestRectLine\n\nmyRect\n\nplayer\n\nrangeLine\n\nmovable\n\ninHold\n\ntestRectLine\n\nmyRect\n\nplayer\n\nholdLine\n\nFirst, we get the coordinates for the movable object's collision rectangle, using worldArea(), a function provided by the area() component. We then use the testRectLine() function to determine whether our player's range line or hold line intersects with this collision rectangle.\n\nNow let's have the gravity gun pull objects in range when the player holds down the right mouse button.", "start_char_idx": 7478, "end_char_idx": 11012, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8": {"__data__": {"id_": "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "44afa851-d5ca-4d99-a51f-d42907b1fc46", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "13a17f5b03f3f0bc8d38b16bb6013e3373bcf05b3e223a3713c156e2fbfa2037", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372", "node_type": "1", "metadata": {}, "hash": "4f82f93b522e9b164a7937fa429a31c96465d9e2f7f7929723c2b7c2c5f9054f", "class_name": "RelatedNodeInfo"}}, "hash": "a31d41dd89a4681e93e90b5eb48eddfa6a26d29b8fee49cab939bd041d8952b5", "text": "We'll do this in an onUpdate() event callback for objects with the \"movable\" tag. Add the following code to the bottom of the main.js file:\n\n// gravity gun pull and hold\n\nonUpdate\n\n\"movable\"\n\nmovable\n\n=>\n\n// test collisions\n\nmyRect\n\nmovable\n\nworldArea\n\nmovable\n\ninRange\n\ntestRectLine\n\nmyRect\n\nplayer\n\nrangeLine\n\nmovable\n\ninHold\n\ntestRectLine\n\nmyRect\n\nplayer\n\nholdLine\n\nFirst, we get the coordinates for the movable object's collision rectangle, using worldArea(), a function provided by the area() component. We then use the testRectLine() function to determine whether our player's range line or hold line intersects with this collision rectangle.\n\nNow let's have the gravity gun pull objects in range when the player holds down the right mouse button. Add the following code below the line where you assigned movable.inHold in the body of the onUpdate event callback:\n\n// gravity gun pull\n\nif\n\nisMouseDown\n\n\"right\"\n\nif\n\nmovable\n\ninHold\n\nmovable\n\nheld\n\ntrue\n\nelse\n\nif\n\nmovable\n\ninRange\n\nmovable\n\nmoveTo\n\nplayer\n\nholdLine\n\np2\n\nIf the object is in holding range, we set held to true. If the object is in pulling range, we move it into holding range. We use the moveTo() function, provided by the pos() component, without a speed argument. This means the object will teleport to the specified position.\n\nNext, we'll handle holding objects once they've been pulled in. Add the following code beneath the code you added above:\n\n// gravity gun hold\n\nif\n\nmovable\n\nheld\n\nmovable\n\nmoveTo\n\nplayer\n\nholdLine\n\np2\n\nThis code will ensure that objects stay in the holding position when held, so the player will be able to move them around in an arc.\n\nFinally, we'll need to move our object after it's been launched. Add the following code below the lines you added above:\n\n// gravity gun launch\n\nmovable\n\nmoveBy\n\ndir\n\nmovable\n\ndirection\n\nscale\n\nmovable\n\nspeed\n\nmovable\n\nspeed\n\nMath\n\nmax\n\nmovable\n\nspeed\n\n//friction\n\nWhen we launch an object, we'll give it a direction and a non-zero speed. We use moveBy(), provided by the pos() component, to move the object unless there are other solid objects in the way. To give the object a more natural movement arc, we will simulate friction by decreasing its speed every frame until it reaches zero.\n\nRun your repl now and try out the gravity gun. You should be able to pull crates into the holding position, and then move them around your head.\n\nFixing the wall-clipping bugs\u200b\n\nIf you play around with the game, you should notice a couple of wall clipping bugs. When holding an object, you can force it to teleport below the platform you're standing on by aiming them. Similarly, objects will teleport through platforms if you pull them from the other side.\n\nIn both cases, this is because Kaboom's moveTo() function does not take solid objects into account, so we'll have to do that ourselves.\n\nWe'll fix the first bug by adding a new, collision-aware movement function to our physics() component. Find the component definition and append the function to the object it returns, just below the draw() function definition:\n\nmoveToNoCollide\n\ndest\n\nconst\n\ndiff\n\ndest\n\nsub\n\nthis\n\npos\n\nreturn\n\nthis\n\nmoveBy\n\ndiff\n\nunit\n\nscale\n\ndiff\n\nlen\n\nThis function calculates the movement vector needed to move from the current position to the destination, and then passes this vector to the collision-aware function moveBy(). Our moveBy() function will return a Collision object if it detects a collision while moving. We'll return this and use it to cancel the hold if certain conditions are met.\n\nFind the if (movable.held) block in your onUpdate(\"movable\") event callback and alter it to match the code below:\n\n// gravity gun hold\n\nif\n\nmovable\n\nheld\n\ncol\n\nmovable\n\nmoveToNoCollide\n\nplayer\n\nholdLine\n\np2\n\nif\n\ncol\n\n!=\n\nnull\n\n&&\n\ncol\n\ntarget\n\nsolid\n\nif\n\ncol\n\ntarget\n\nis\n\n\"player\"\n\n// disregard player collisions\n\nmovable\n\nmoveTo\n\nplayer\n\nholdLine\n\np2\n\nelse\n\nmovable\n\nheld\n\nfalse\n\nHere we've replaced moveTo() with moveToNoCollide(), and we're doing some checks on the collision object returned. If the collision is with the player, we ignore it and move the object back to the hold position. Otherwise, we cancel the hold.", "start_char_idx": 10259, "end_char_idx": 14392, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372": {"__data__": {"id_": "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "a31d41dd89a4681e93e90b5eb48eddfa6a26d29b8fee49cab939bd041d8952b5", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "2790214f-4e6e-46f6-9b85-d4093d55901a", "node_type": "1", "metadata": {}, "hash": "be4bf3a0b9c2563c0598806b114dc12caf21c9fb19c6b283bf1a323864beeab3", "class_name": "RelatedNodeInfo"}}, "hash": "4f82f93b522e9b164a7937fa429a31c96465d9e2f7f7929723c2b7c2c5f9054f", "text": "We'll return this and use it to cancel the hold if certain conditions are met.\n\nFind the if (movable.held) block in your onUpdate(\"movable\") event callback and alter it to match the code below:\n\n// gravity gun hold\n\nif\n\nmovable\n\nheld\n\ncol\n\nmovable\n\nmoveToNoCollide\n\nplayer\n\nholdLine\n\np2\n\nif\n\ncol\n\n!=\n\nnull\n\n&&\n\ncol\n\ntarget\n\nsolid\n\nif\n\ncol\n\ntarget\n\nis\n\n\"player\"\n\n// disregard player collisions\n\nmovable\n\nmoveTo\n\nplayer\n\nholdLine\n\np2\n\nelse\n\nmovable\n\nheld\n\nfalse\n\nHere we've replaced moveTo() with moveToNoCollide(), and we're doing some checks on the collision object returned. If the collision is with the player, we ignore it and move the object back to the hold position. Otherwise, we cancel the hold.\n\nRefresh your repl browser now and try to clip a held crate through the floor. You should be unsuccessful.\n\nTo fix the second clipping bug, we're going to need to detect solid objects between the movable object being pulled and the player's hold position. We'll write a new helper function to do this. Add the following code near the top of your file, just under the definition of pointAt():\n\nfunction\n\ncheckCollisionLine\n\nline\n\ntag\n\ncollision\n\nget\n\ntag\n\nsome\n\nobject\n\n=>\n\nreturn\n\ntestRectLine\n\nobject\n\nworldArea\n\nline\n\nreturn\n\ncollision\n\nThe checkCollisionLine() function tests whether an object with a given tag intersects with a line. We do this by getting all objects with the tag and testing each one until we find a collision. The some() method will stop executing after a single true is returned, so this isn't quite as inefficient as it could be, but it's still probably not the optimal way to do this. Nonetheless, it should work fine while our game is relatively small.\n\nTo use this function, find the if (isMouseDown(\"right\")) in your onUpdate(\"movable\") event callback and make the modifications shown:\n\n// gravity gun pull\n\nif\n\nisMouseDown\n\n\"right\"\n\ncolLine\n\n// new object definition\n\np1\n\nmovable\n\npos\n\np2\n\nplayer\n\nholdLine\n\np2\n\nif\n\nmovable\n\ninHold\n\nmovable\n\nheld\n\ntrue\n\n// expanded expression below\n\nelse\n\nif\n\nmovable\n\ninRange\n\n&&\n\ncheckCollisionLine\n\ncolLine\n\n\"wall\"\n\nmovable\n\nmoveTo\n\nplayer\n\nholdLine\n\np2\n\nTo prevent the player from pulling objects through walls, we check that the line between the object in range and the player's hold position is free of walls before moving it. Rerun your repl now, and you should be unable to clip objects through walls.\n\nDropping and launching objects with the gravity gun\u200b\n\nNow that we have a stable pulling and holding implementation, we need to be able to drop and launch objects. Add the following code at the bottom of your file:\n\n// gravity gun drop\n\nonMousePress\n\n\"right\"\n\n=>\n\nholdList\n\nget\n\n\"movable\"\n\nfilter\n\nelement\n\n=>\n\nreturn\n\nelement\n\nheld\n\nif\n\nholdList\n\nlength\n\nselected\n\nholdList\n\nselected\n\nheld\n\nfalse\n\nWhen the right mouse button is clicked, we retrieve all the \"movable\"-tagged objects and filter out the ones that aren't currently held. Only one object can be held at a time, so we select that object and release it.\n\nIf you restart your repl now, you may have trouble getting dropping to work. Because we use the right mouse button both for pulling and dropping, you need to be quite precise to avoid immediately grabbing objects after dropping them.\n\nLet's implement a dropping timeout for dropped objects to make this more user-friendly. Add the following lines below selected.held = false:\n\nselected\n\ndropping\n\ntrue\n\nwait\n\n0.2\n\n=>\n\nselected\n\ndropping\n\nfalse\n\nThis code uses a wait() callback, which will execute after the given number of seconds.\n\nWe defined the dropping attribute as part of our physics() component, so now all we need to do is make our pull respect the timeout. Find the if (isMouseDown(\"right\")) line in your onUpdate(\"movable\") event callback and alter it to resemble the following:\n\n// gravity gun pull\n\nif\n\nisMouseDown\n\n\"right\"\n\n&&\n\nmovable\n\ndropping\n\nNow you should be able to drop objects more easily.\n\nFinally, let's add some code to launch objects when the left mouse button is clicked. Enter the following code at the bottom of your file.", "start_char_idx": 13689, "end_char_idx": 17736, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "2790214f-4e6e-46f6-9b85-d4093d55901a": {"__data__": {"id_": "2790214f-4e6e-46f6-9b85-d4093d55901a", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "e29053b39a07a7647a39b2de22780dfd947b2e4982aec31b625b65fcbd6a5b97", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}, "hash": "4f82f93b522e9b164a7937fa429a31c96465d9e2f7f7929723c2b7c2c5f9054f", "class_name": "RelatedNodeInfo"}}, "hash": "be4bf3a0b9c2563c0598806b114dc12caf21c9fb19c6b283bf1a323864beeab3", "text": "Let's implement a dropping timeout for dropped objects to make this more user-friendly. Add the following lines below selected.held = false:\n\nselected\n\ndropping\n\ntrue\n\nwait\n\n0.2\n\n=>\n\nselected\n\ndropping\n\nfalse\n\nThis code uses a wait() callback, which will execute after the given number of seconds.\n\nWe defined the dropping attribute as part of our physics() component, so now all we need to do is make our pull respect the timeout. Find the if (isMouseDown(\"right\")) line in your onUpdate(\"movable\") event callback and alter it to resemble the following:\n\n// gravity gun pull\n\nif\n\nisMouseDown\n\n\"right\"\n\n&&\n\nmovable\n\ndropping\n\nNow you should be able to drop objects more easily.\n\nFinally, let's add some code to launch objects when the left mouse button is clicked. Enter the following code at the bottom of your file.\n\n// gravity gun launch\n\nonMousePress\n\n\"left\"\n\n=>\n\nrangeList\n\nget\n\n\"movable\"\n\nfilter\n\nelement\n\n=>\n\nreturn\n\nelement\n\nheld\n\nif\n\nrangeList\n\nlength\n\nselected\n\nrangeList\n\n// 1st for now\n\nselected\n\nheld\n\nfalse\n\nselected\n\ndirection\n\nrad2deg\n\nplayer\n\naimAngle\n\nselected\n\nspeed\n\nplayer\n\nfirepower\n\nThis code is largely similar to the dropping code, but instead of specifying a drop timeout, we give the previously held object a direction and a speed. The direction will be the player's aimAngle, which we need to convert to degrees for Kaboom. The speed will be the firepower value we defined in our gravitygun() module.\n\nRestart your repl and play around with picking up, dropping and launching crates. Some odd behavior you may notice is that objects launched straight will tend to slide along the ceiling for a while as they bleed off their speed. We can prevent this by adding the following code to kill a movable object's speed on collision with a wall:\n\nonCollide\n\n\"movable\"\n\n\"wall\"\n\n=>\n\nspeed\n\nObject collisions\u200b\n\nOur physics playground wouldn't be complete without collisions between objects, so let's add some simple code to make objects push each other. Add the following collision handler to the bottom of your file:\n\n// physics object collisions\n\nonCollide\n\n\"movable\"\n\n\"movable\"\n\n=>\n\nif\n\nspeed\n\nspeed\n\ndirection\n\ndirection\n\nelse\n\nif\n\nspeed\n\n<=\n\nspeed\n\ndirection\n\ndirection\n\nfinalSpeed\n\nspeed\n\nspeed\n\nmass\n\nmass\n\nspeed\n\nfinalSpeed\n\nspeed\n\nfinalSpeed\n\nThis code will assign the direction of the fastest object to both objects, and determine the speed of both from an altered form of a simple one-dimensional collision formula. Play around with the values and calculations and see what sort of behavior you prefer. Remember, it's more important for a game to be fun than for it to be realistic.\n\nNext steps\u200b\n\nWe've built a rudimentary physics-based platform engine. From here, there's a lot you can do to expand this into a full game. Consider the following ideas:\n\nAdd enemies to throw crates at.\n\nAdd more movable objects of different sizes and masses.\n\nAdd puzzles that can be solved by arranging crates in specific patterns, and launching them from specific angles.\n\nImprove the physics simulation with 2D collisions, rotating objects, and objects with different behaviors, such as bouncing and shattering.\n\nYou can find our repl here:\n\n< Previous: Kaboom editor\n\nNext: Web3 >\n\nWas this helpful?\n\nLast updated on Aug 31, 2023\n\nGetting started\n\nSetting the scene\n\nMoving the player\n\nPulling objects with the gravity gunFixing the wall-clipping bugs\n\nDropping and launching objects with the gravity gun\n\nObject collisions\n\nNext steps", "start_char_idx": 16919, "end_char_idx": 20371, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}}, "docstore/ref_doc_info": {"b1640d3b-62d2-4e00-9f40-e620defb5b6b": {"node_ids": ["61a304cb-d78a-4fc8-89ca-7d8a5c13acf2", "2d49c9b9-fb36-4d36-9757-c488982ad951", "44afa851-d5ca-4d99-a51f-d42907b1fc46", "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8", "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372", "2790214f-4e6e-46f6-9b85-d4093d55901a"], "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/kaboom/physics-playground-with-kaboom.html"}}}, "docstore/metadata": {"61a304cb-d78a-4fc8-89ca-7d8a5c13acf2": {"doc_hash": "1ec914a3b10fa50eb8179568b4dcd40781a277b3971bde4f73a5a14fe1340a89", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}, "2d49c9b9-fb36-4d36-9757-c488982ad951": {"doc_hash": "4cea596238d6b793592811e326bb222b2bc1bef03838af557c0b05e3b54d8a8a", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}, "44afa851-d5ca-4d99-a51f-d42907b1fc46": {"doc_hash": "13a17f5b03f3f0bc8d38b16bb6013e3373bcf05b3e223a3713c156e2fbfa2037", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}, "18bdb9ab-c64a-44e2-bdec-e3d9a44418b8": {"doc_hash": "a31d41dd89a4681e93e90b5eb48eddfa6a26d29b8fee49cab939bd041d8952b5", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}, "14c5aa4c-566a-4b5d-9d63-5cfb7a39e372": {"doc_hash": "4f82f93b522e9b164a7937fa429a31c96465d9e2f7f7929723c2b7c2c5f9054f", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}, "2790214f-4e6e-46f6-9b85-d4093d55901a": {"doc_hash": "be4bf3a0b9c2563c0598806b114dc12caf21c9fb19c6b283bf1a323864beeab3", "ref_doc_id": "b1640d3b-62d2-4e00-9f40-e620defb5b6b"}}}