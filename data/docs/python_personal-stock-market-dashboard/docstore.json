{"docstore/data": {"428f5bae-7031-4b58-95ec-ab7201d0ea5c": {"__data__": {"id_": "428f5bae-7031-4b58-95ec-ab7201d0ea5c", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "1728c083-3dfb-4645-a693-aaf284e9d6b0", "node_type": "1", "metadata": {}, "hash": "b94c14080b1bb14600d428276a604af1f09522f8d419f781137111c80f246147", "class_name": "RelatedNodeInfo"}}, "hash": "441d3321f26b685ba74d333221a32edc46638ebd31fcbfc1f68fedf1236f4d76", "text": "name\n\nticker\n\n/>\n\ninput\n\ntype\n\ntext\n\nplaceholder\n\n# shares\n\nname\n\nshares\n\n/>\n\ninput\n\ntype\n\ntext\n\nplaceholder\n\nprice\n\nname\n\nprice\n\n/>\n\ninput\n\ntype\n\nsubmit\n\nvalue\n\nBuy\n\n/>\n\n</\n\nform\n\ntable\n\nid\n\nportfolio\n\ntr\n\nth\n\nTicker\n\n</\n\nth\n\nth\n\nNumber of shares\n\n</\n\nth\n\nth\n\nTotal cost\n\n</\n\nth\n\nth\n\nCurrent value\n\n</\n\nth\n\nth\n\nPercent change\n\n</\n\nth\n\n</\n\ntr\n\ntr\n\ntd\n\nLoading...\n\n</\n\ntd\n\n</\n\ntr\n\ntr\n\n</\n\ntr\n\n</\n\ntable\n\nhref\n\n/flush\n\nFlush DB\n\n</\n\n</\n\nbody\n\n</\n\nhtml\n\nIn this file, we've imported Bootstrap CSS and applied some minimal styles of our own to make the default content look a little better. We've also created a form for recording share purchases, and a table that will display our share portfolio.\n\nNow let's write some Python code so we can display this page in our Flask app. Enter the following code in main.py:\n\nfrom\n\nflask\n\nimport\n\nFlask\n\nrender_template\n\nrequest\n\njsonify\n\nurl_for\n\nredirect\n\nimport\n\njson\n\nsite\n\nFlask\n\n__name__\n\n@site\n\nroute\n\n'/'\n\ndef\n\nindex\n\nreturn\n\nrender_template\n\n'index.html'\n\nsite\n\nrun\n\nhost\n\n'0.0.0.0'\n\nport\n\n8080\n\nNow run your repl. The resulting page should look like this:\n\nThe first thing we need to implement to get this page functional is the share purchase form. Let's do that now.\n\nAccessing the Database and Recording Purchases\u200b\n\nWe can allow users to \"buy\" stock by entering the ticker symbol, the number of shares purchased, and the price per share. While it would also make sense to record the purchase time, we will leave that out for the sake of simplicity (but you can add it later on your own).\n\nWe will record these purchases by adding them to the Replit database. This is a simple key-value store that you can think of as a big Python dictionary which retains its state between runs of a repl. Using this database will save us from having to re-enter all of our stock information every time we restart our dashboard.\n\nTo use the Replit Database, all we have to do is add the following import statement at the top of main.py:\n\nfrom\n\nreplit\n\nimport\n\ndb\n\nNow we can use the globally scoped variable db like a Python dictionary, keeping in mind that whatever we store in it will persist between executions of our application. A cheat sheet for using the database is available from your repl's database tab on the sidebar.\n\nLet's give it a spin and write the function for buying shares. Add the following code just above the line beginning with site.run:\n\n@site\n\nroute\n\n'/buy'\n\nmethods\n\n'POST'\n\ndef\n\nbuy\n\n# Create shares key if it doesn't exist\n\nif\n\n'shares'\n\nnot\n\nin\n\ndb\n\nkeys\n\ndb\n\n'shares'\n\n# Extract values from form\n\nticker\n\nrequest\n\nform\n\n'ticker'\n\nupper\n\nprice\n\nfloat\n\nrequest\n\nform\n\n'price'\n\nshares\n\nint\n\nrequest\n\nform\n\n'shares'\n\nif\n\nticker\n\nnot\n\nin\n\ndb\n\n'shares'\n\n# buying these for the first time\n\ndb\n\n'shares'\n\nticker\n\n'total_shares'\n\nshares\n\n'total_cost'\n\nshares\n\nprice\n\ndb\n\n'shares'\n\nticker\n\n'purchases'\n\n'shares'\n\nshares\n\n'price'\n\nprice\n\nelse\n\n# buying more\n\ndb\n\n'shares'\n\nticker\n\n'total_shares'\n\n+=\n\nshares\n\ndb\n\n'shares'\n\nticker\n\n'total_cost'\n\n+=\n\nshares\n\nprice\n\ndb\n\n'shares'\n\nticker\n\n'purchases'\n\nappend\n\n'shares'\n\nshares\n\n'price'\n\nprice\n\nreturn\n\nredirect\n\nurl_for\n\n\"index\"\n\nFirst, if necessary, we create an empty dictionary at the \"shares\" key of our db database. This code will only need to run the first time we buy shares.\n\nThen, we extract the ticker, price and number of shares from the form data, coercing each one into an appropriate format. We want stock tickers to be uppercase and a maximum of five characters long, prices to include fractional amounts, and number of shares to be integers (though you could change that later to support fractional shares).\n\nFinally, we add our share purchase to the \"shares\" dictionary. This dictionary is made up of ticker symbol keys mapped to inner dictionaries, which in turn contain the following information:\n\nThe total number of shares owned.\n\nThe total cost of all shares purchased.\n\nA list of individual purchases.", "start_char_idx": 0, "end_char_idx": 3924, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "1728c083-3dfb-4645-a693-aaf284e9d6b0": {"__data__": {"id_": "1728c083-3dfb-4645-a693-aaf284e9d6b0", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "428f5bae-7031-4b58-95ec-ab7201d0ea5c", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "441d3321f26b685ba74d333221a32edc46638ebd31fcbfc1f68fedf1236f4d76", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8", "node_type": "1", "metadata": {}, "hash": "3f66df16ec7eca763b953c1cae04bd1d0ea00367ad0dddb060a692b0fe3d641d", "class_name": "RelatedNodeInfo"}}, "hash": "b94c14080b1bb14600d428276a604af1f09522f8d419f781137111c80f246147", "text": "This code will only need to run the first time we buy shares.\n\nThen, we extract the ticker, price and number of shares from the form data, coercing each one into an appropriate format. We want stock tickers to be uppercase and a maximum of five characters long, prices to include fractional amounts, and number of shares to be integers (though you could change that later to support fractional shares).\n\nFinally, we add our share purchase to the \"shares\" dictionary. This dictionary is made up of ticker symbol keys mapped to inner dictionaries, which in turn contain the following information:\n\nThe total number of shares owned.\n\nThe total cost of all shares purchased.\n\nA list of individual purchases. Each purchase is a dictionary containing the number of shares purchased, and their unit price.\n\nThis may seem like a complicated structure, but it is necessary to allow users to buy shares in the same company at different prices. With some data added, our dictionary could look like this:\n\n\"AAPL\"\n\n\"total_shares\"\n\n15\n\n\"total_cost\"\n\n1550\n\n\"purchases\"\n\n\"shares\"\n\n10\n\n\"price\"\n\n100\n\n\"shares\"\n\n\"price\"\n\n110\n\n\"MSFT\"\n\n\"total_shares\"\n\n20\n\n\"total_cost\"\n\n4000\n\n\"purchases\"\n\n\"shares\"\n\n20\n\n\"price\"\n\n200\n\nIn the data above, we've bought 10 shares of Apple Inc (AAPL) at $100 per share, and 5 at $110 per share. We've also bought 20 shares of Microsoft Corporation (MSFT) at $200 per share. The total_shares and total_cost values could be derived from the list of purchases, but we're storing them in the database to avoid having to recalculate them unnecessarily.\n\nRun your code now, and add a few stocks with random values. You can use some example tickers: AAPL, MSFT, AMZN, FB, GOOG. While our purchases won't show up on our dashboard, you can determine whether they're getting added to the database by visiting the database tab on your repl's sidebar. If your code is correct, you should see non-zero values under the \"STORAGE\" heading.\n\nAt the moment, our dashboard will also allow you to add any value as a ticker symbol, even if it's not a real public company. And, needless to say, our dashboard also doesn't show us the current value of our stocks. We'll fix those issues soon, but first we need to implement some functionality to help us test.\n\nFlushing the Database\u200b\n\nA persistent database is vital for creating most useful web applications, but it can get messy in the early stages of development when we're adding a lot of different test data and experimenting with different structures. That's why it's useful to have a quick and easy way to delete everything.\n\nWe've already included a link to flush the database in our index.html file, so now let's create the backend functionality in Flask. Add this code to main.py, below the buy function:\n\n@site\n\nroute\n\n'/flush'\n\ndef\n\nflush_db\n\ndel\n\ndb\n\n\"shares\"\n\nreturn\n\nredirect\n\nurl_for\n\n\"index\"\n\nHere we're deleting the shares key from our database and then redirecting the user to the dashboard. As shares is the only key in our database, this code will suffice for now, but if we add more keys, we'll have to change it accordingly.\n\nTest this new functionality out by flushing your database before moving on to the next section, especially if you have invalid stock tickers. You can confirm whether the flush worked by checking the database tab of your repl's sidebar, where the values under \"STORAGE\" should now be zero. Note that deletion may take a few seconds to reflect.\n\nServing Our Portfolio Data\u200b\n\nWe want our dashboard to be a live display that fetches new stock prices periodically, without us having to refresh the page. It would also be nice to unload calculations such as percentage gain or loss to the client's web browser, so we can reduce load on our server. To this end, we will be structuring our portfolio viewing functionality as an API endpoint that is queried by JavaScript code, rather than using Jinja templates to build it on the server-side.\n\nThe first thing we must do to achieve this is to create a Flask endpoint that returns the user's portfolio. We'll do this at /portfolio.", "start_char_idx": 3221, "end_char_idx": 7276, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8": {"__data__": {"id_": "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "1728c083-3dfb-4645-a693-aaf284e9d6b0", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "b94c14080b1bb14600d428276a604af1f09522f8d419f781137111c80f246147", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1", "node_type": "1", "metadata": {}, "hash": "d199eee34e9175aba96285ebe177f7c31bc73a7449ebe8a32d7d5b91cd01a7b8", "class_name": "RelatedNodeInfo"}}, "hash": "3f66df16ec7eca763b953c1cae04bd1d0ea00367ad0dddb060a692b0fe3d641d", "text": "You can confirm whether the flush worked by checking the database tab of your repl's sidebar, where the values under \"STORAGE\" should now be zero. Note that deletion may take a few seconds to reflect.\n\nServing Our Portfolio Data\u200b\n\nWe want our dashboard to be a live display that fetches new stock prices periodically, without us having to refresh the page. It would also be nice to unload calculations such as percentage gain or loss to the client's web browser, so we can reduce load on our server. To this end, we will be structuring our portfolio viewing functionality as an API endpoint that is queried by JavaScript code, rather than using Jinja templates to build it on the server-side.\n\nThe first thing we must do to achieve this is to create a Flask endpoint that returns the user's portfolio. We'll do this at /portfolio. Add the following code to main.py, below the buy function:\n\n@site\n\nroute\n\n'/portfolio'\n\ndef\n\nportfolio\n\nif\n\n\"shares\"\n\nnot\n\nin\n\ndb\n\nkeys\n\nreturn\n\njsonify\n\nportfolio\n\njson\n\nloads\n\ndb\n\nget_raw\n\n\"shares\"\n\n# Get current values\n\nfor\n\nticker\n\nin\n\nportfolio\n\nkeys\n\ncurrent_price\n\nfloat\n\nget_price\n\nticker\n\ncurrent_value\n\ncurrent_price\n\nportfolio\n\nticker\n\n'total_shares'\n\nportfolio\n\nticker\n\n'current_value'\n\ncurrent_value\n\nreturn\n\njsonify\n\n**\n\nportfolio\n\nThe purpose of this function is to serve a JSON object of the shares portfolio to the client. Later, we'll write JavaScript for our dashboard which will use this object to construct a table showing our portfolio information.\n\nIn the above code, if no stocks have been added, we return an empty JSON object. Otherwise, we set portfolio to a copy of the shares dictionary in our Replit database. The Python Replit library uses custom list and dictionary types that cannot be directly serialized into JSON, so we use db.get_raw to convert the whole thing into a string and json.loads to convert that string into a standard Python dictionary.\n\nThen we need to get the current values for each of our stock holdings. To do so, we loop through portfolio.keys(), call get_price(ticker) and multiply the return value by the total shares we're holding for this stock. We then add this value under the new current_value key in our stock's dictionary.\n\nFinally, we convert our portfolio dictionary to JSON using Flask's jsonify and return it.\n\nThere's just one problem: we haven't implemented get_price yet! Let's do that now, before we try to run this code.\n\nFetching Current Prices\u200b\n\nWe'll fetch the current prices of our stocks by scraping the Yahoo Finance website. While the more traditional and foolproof way of consuming structured data such as share prices is to use an API that provides structured data in a computer-ready format, this is not always feasible, as the relevant APIs may be limited or even non-existent. For these and other reasons, web scraping is a useful skill to have.\n\nA quick disclaimer before we jump in: Copyright law and web scraping laws are complex and differ by country. As long as you aren't blatantly copying their content or doing web scraping for commercial gain, people generally don't mind web scraping. However, there have been some legal cases involving scraping data from LinkedIn, and media attention from scraping data from OKCupid. Web scraping can violate the law, go against a particular website's terms of service, or breach ethical guidelines \u2013 so take care with where you apply this skill.\n\nAdditionally, from a practical perspective, web scraping code is usually brittle and likely to break in the event that a scraped site changes its appearance.\n\nWith those considerations in mind, let's start scraping. We'll use Python Requests to fetch web pages and Beautiful Soup to parse them and extract the parts we're interested in. Let's import those at the top of main.py.\n\nfrom\n\nbs4\n\nimport\n\nBeautifulSoup\n\nimport\n\nrequests\n\nNow we can create our get_price function. Enter the following code near the top of main.py, just below site = Flask(__name__):\n\ndef\n\nget_price\n\nticker\n\npage\n\nrequests\n\nget\n\n\"https://finance.yahoo.com/quote/\"\n\nticker\n\nsoup\n\nBeautifulSoup\n\npage\n\ntext\n\n\"html5lib\"\n\nprice\n\nsoup\n\nfind\n\n'fin-streamer'\n\n'class'\n\n'Fw(b) Fz(36px) Mb(-4px) D(ib)'\n\ntext\n\n# remove thousands separator\n\nprice\n\nprice\n\nreplace\n\n\",\"\n\n\"\"\n\nreturn\n\nprice\n\nThe first line fetches the page on Yahoo Finance that shows information about our stock share price.", "start_char_idx": 6446, "end_char_idx": 10808, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1": {"__data__": {"id_": "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "3f66df16ec7eca763b953c1cae04bd1d0ea00367ad0dddb060a692b0fe3d641d", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5", "node_type": "1", "metadata": {}, "hash": "817985f8cdb4a41f678addded68ab1594387377e0643b36da29df7e00a5bc6f1", "class_name": "RelatedNodeInfo"}}, "hash": "d199eee34e9175aba96285ebe177f7c31bc73a7449ebe8a32d7d5b91cd01a7b8", "text": "We'll use Python Requests to fetch web pages and Beautiful Soup to parse them and extract the parts we're interested in. Let's import those at the top of main.py.\n\nfrom\n\nbs4\n\nimport\n\nBeautifulSoup\n\nimport\n\nrequests\n\nNow we can create our get_price function. Enter the following code near the top of main.py, just below site = Flask(__name__):\n\ndef\n\nget_price\n\nticker\n\npage\n\nrequests\n\nget\n\n\"https://finance.yahoo.com/quote/\"\n\nticker\n\nsoup\n\nBeautifulSoup\n\npage\n\ntext\n\n\"html5lib\"\n\nprice\n\nsoup\n\nfind\n\n'fin-streamer'\n\n'class'\n\n'Fw(b) Fz(36px) Mb(-4px) D(ib)'\n\ntext\n\n# remove thousands separator\n\nprice\n\nprice\n\nreplace\n\n\",\"\n\n\"\"\n\nreturn\n\nprice\n\nThe first line fetches the page on Yahoo Finance that shows information about our stock share price. For example, the link below will show share price information for Apple Inc:\n\nhttps://finance.yahoo.com/quote/AAPL\n\nWe then load the page into a Beautiful Soup object, parsing it as HTML5 content. Finally, we need to find the price. If you visit the above page in your browser, right-click on the price near the top of the page and select \"Inspect\". You'll notice that it's inside a fin-streamer element with a class value containing Fw(b) Fz(36px) Mb(-4px) D(ib). If the market is open, and the price is changing, additional classes may be added and removed as you watch, but the previously mentioned value should still be sufficient.\n\nWe use Beautiful Soup's find method to locate this fin-streamer. The text attribute of the object returned is the price we want. Before returning it, we remove any comma thousands separators to avoid float conversion errors later on.\n\nAlthough we've implemented this functionality for the sake of portfolio viewing, we can also use it to improve our share buying process. We'll make a few additional quality-of-life changes at the same time. Find your buy function code and modify it to look like this:\n\n@site\n\nroute\n\n'/buy'\n\nmethods\n\n'POST'\n\ndef\n\nbuy\n\n# Create shares key if it doesn't exist\n\nif\n\n'shares'\n\nnot\n\nin\n\ndb\n\nkeys\n\ndb\n\n'shares'\n\nticker\n\nrequest\n\nform\n\n'ticker'\n\n# remove starting $\n\nif\n\nticker\n\n==\n\n'$'\n\nticker\n\nticker\n\n# uppercase and maximum five characters\n\nticker\n\nticker\n\nupper\n\ncurrent_price\n\nget_price\n\nticker\n\nif\n\nnot\n\nget_price\n\nticker\n\n# reject invalid tickers\n\nreturn\n\nf\"Ticker $'\n\nticker\n\n' not found\"\n\nif\n\nnot\n\nrequest\n\nform\n\n'price'\n\n# use current price if price not specified\n\nprice\n\nfloat\n\ncurrent_price\n\nelse\n\nprice\n\nfloat\n\nrequest\n\nform\n\n'price'\n\nif\n\nnot\n\nrequest\n\nform\n\n'shares'\n\n# buy one if number not specified\n\nshares\n\nelse\n\nshares\n\nint\n\nrequest\n\nform\n\n'shares'\n\nif\n\nticker\n\nnot\n\nin\n\ndb\n\n'shares'\n\n# buying these for the first time\n\ndb\n\n'shares'\n\nticker\n\n'total_shares'\n\nshares\n\n'total_cost'\n\nshares\n\nprice\n\ndb\n\n'shares'\n\nticker\n\n'purchases'\n\n'shares'\n\nshares\n\n'price'\n\nprice\n\nelse\n\n# buying more\n\ndb\n\n'shares'\n\nticker\n\n'total_shares'\n\n+=\n\nshares\n\ndb\n\n'shares'\n\nticker\n\n'total_cost'\n\n+=\n\nshares\n\nprice\n\ndb\n\n'shares'\n\nticker\n\n'purchases'\n\nappend\n\n'shares'\n\nshares\n\n'price'\n\nprice\n\nreturn\n\nredirect\n\nurl_for\n\n\"index\"\n\nThe first change we've made to this function is to strip leading $s on ticker symbols, in case users include those. Then, by calling get_price in this function, we can both prevent users from adding invalid stock tickers and allow users to record purchases at the current price by leaving the price field blank. Additionally, we'll assume users want to buy just one share if they leave the number of shares field blank.\n\nWe can now test out our code. Run your repl, add some stocks, and then, in a separate tab, navigate to this URL (replacing the two ALL-CAPS values first):\n\nhttps://YOUR-REPL-NAME--YOUR-USERNAME.repl.co/portfolio\n\nNote: Please refer to these docs to ensure that you are using the correct repl.co domain format.\n\nYou should now see a JSON object similar to the database structure detailed above, with the current value of each stock holding as an additional field. In the next section, we'll display this data on our dashboard.", "start_char_idx": 10070, "end_char_idx": 14043, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5": {"__data__": {"id_": "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "d199eee34e9175aba96285ebe177f7c31bc73a7449ebe8a32d7d5b91cd01a7b8", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "de22991b-ad66-47c0-ba15-a5df7a4a171b", "node_type": "1", "metadata": {}, "hash": "afbcd5bee62604c4e5a744d0624b7fc695f1e33077cd7683c3b635722543248c", "class_name": "RelatedNodeInfo"}}, "hash": "817985f8cdb4a41f678addded68ab1594387377e0643b36da29df7e00a5bc6f1", "text": "Then, by calling get_price in this function, we can both prevent users from adding invalid stock tickers and allow users to record purchases at the current price by leaving the price field blank. Additionally, we'll assume users want to buy just one share if they leave the number of shares field blank.\n\nWe can now test out our code. Run your repl, add some stocks, and then, in a separate tab, navigate to this URL (replacing the two ALL-CAPS values first):\n\nhttps://YOUR-REPL-NAME--YOUR-USERNAME.repl.co/portfolio\n\nNote: Please refer to these docs to ensure that you are using the correct repl.co domain format.\n\nYou should now see a JSON object similar to the database structure detailed above, with the current value of each stock holding as an additional field. In the next section, we'll display this data on our dashboard.\n\nShowing Our Portfolio\u200b\n\nWe will need to write some JavaScript to fetch our portfolio information, assemble it into a table, and calculate the percentage changes for each stock as well as our portfolio's total cost, current value and percentage change.\n\nAdd the following code just above the closing </body> tag in templates/index.html:\n\nscript\n\nfunction\n\ngetPortfolio\n\nfetch\n\n\"/portfolio\"\n\nthen\n\nresponse\n\n=>\n\nresponse\n\njson\n\nthen\n\ndata\n\n=>\n\nconsole\n\nlog\n\ndata\n\ngetPortfolio\n\n</\n\nscript\n\nThis code uses the Fetch API to query our /portfolio endpoint and returns a Promise, which we feed into two then methods. The first one extracts the JSON data from the response, and the second one logs the data to JavaScript console. This is a common pattern in JavaScript, which provides a lot of asynchronous functionality.\n\nRun your repl and open its web page in a new tab.\n\nThen open your browser's devtools with F12, and you should see your portfolio JSON object in the console. If you don't, give it a few seconds.\n\nNow let's add the rest of our JavaScript code. Delete console.log(data); and add the following code in its place:\n\nvar\n\ntable\n\ndocument\n\ngetElementById\n\n\"portfolio\"\n\nvar\n\ntableHTML\n\n<tr>\n\n<th>Ticker</th>\n\n<th>Number of shares</th>\n\n<th>Total cost</th>\n\n<th>Current value</th>\n\n<th>Percent change</th>\n\n</tr>\n\nvar\n\nportfolioCost\n\nvar\n\nportfolioCurrent\n\nfor\n\nvar\n\nticker\n\nin\n\ndata\n\nvar\n\ntotalShares\n\ndata\n\nticker\n\n\"total_shares\"\n\nvar\n\ntotalCost\n\ndata\n\nticker\n\n\"total_cost\"\n\nvar\n\ncurrentValue\n\ndata\n\nticker\n\n\"current_value\"\n\nvar\n\npercentChange\n\npercentChangeCalc\n\ntotalCost\n\ncurrentValue\n\nrow\n\n\"<tr>\"\n\nrow\n\n+=\n\n\"<td>$\"\n\nticker\n\n\"</td>\"\n\nrow\n\n+=\n\n\"<td>\"\n\ntotalShares\n\n\"</td>\"\n\nrow\n\n+=\n\n\"<td>$\"\n\ntotalCost\n\ntoFixed\n\n\"</td>\"\n\nrow\n\n+=\n\n\"<td>$\"\n\ncurrentValue\n\ntoFixed\n\n\"</td>\"\n\nrow\n\n+=\n\npercentChangeRow\n\npercentChange\n\nrow\n\n+=\n\n\"</tr>\"\n\ntableHTML\n\n+=\n\nrow\n\nportfolioCost\n\n+=\n\ntotalCost\n\nportfolioCurrent\n\n+=\n\ncurrentValue\n\nportfolioPercentChange\n\npercentChangeCalc\n\nportfolioCost\n\nportfolioCurrent\n\ntableHTML\n\n+=\n\n\"<tr>\"\n\ntableHTML\n\n+=\n\n\"<th>Total</th>\"\n\ntableHTML\n\n+=\n\n\"<th>&nbsp;</th>\"\n\ntableHTML\n\n+=\n\n\"<th>$\"\n\nportfolioCost\n\ntoFixed\n\n\"</th>\"\n\ntableHTML\n\n+=\n\n\"<th>$\"\n\nportfolioCurrent\n\ntoFixed\n\n\"</th>\"\n\ntableHTML\n\n+=\n\npercentChangeRow\n\nportfolioPercentChange\n\ntableHTML\n\n+=\n\n\"</tr>\"\n\ntable\n\ninnerHTML\n\ntableHTML\n\nThis code constructs an HTML table containing the values queried from our portfolio endpoint, as well as the extra calculated values we mentioned above. We use the toFixed method to cap the number of decimal places for financial values to two.\n\nWe also use a couple of helper functions for calculating and displaying percentage changes. Add the code for these above the getPortfolio function declaration:\n\nfunction\n\npercentChangeCalc\n\nreturn\n\n!=\n\n100\n\nfunction\n\npercentChangeRow\n\npercentChange\n\nif\n\npercentChange\n\nreturn\n\n\"<td class='positive'>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nelse\n\nif\n\npercentChange\n\nreturn\n\n\"<td class='negative'>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nelse\n\nreturn\n\n\"<td>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nThe percentChangeCalc function calculates the percentage difference between two numbers, avoiding division by zero. The percentChangeRow function allows us to style gains and losses differently by adding classes that we've already declared in the page's CSS.", "start_char_idx": 13213, "end_char_idx": 17351, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "de22991b-ad66-47c0-ba15-a5df7a4a171b": {"__data__": {"id_": "de22991b-ad66-47c0-ba15-a5df7a4a171b", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "817985f8cdb4a41f678addded68ab1594387377e0643b36da29df7e00a5bc6f1", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "37944587-552b-48b6-b876-78d63c8f6cb5", "node_type": "1", "metadata": {}, "hash": "377042580c678d0a4b4630311482d4ed064ecba0352d53ab9f3cc2fc8bdda61e", "class_name": "RelatedNodeInfo"}}, "hash": "afbcd5bee62604c4e5a744d0624b7fc695f1e33077cd7683c3b635722543248c", "text": "We use the toFixed method to cap the number of decimal places for financial values to two.\n\nWe also use a couple of helper functions for calculating and displaying percentage changes. Add the code for these above the getPortfolio function declaration:\n\nfunction\n\npercentChangeCalc\n\nreturn\n\n!=\n\n100\n\nfunction\n\npercentChangeRow\n\npercentChange\n\nif\n\npercentChange\n\nreturn\n\n\"<td class='positive'>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nelse\n\nif\n\npercentChange\n\nreturn\n\n\"<td class='negative'>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nelse\n\nreturn\n\n\"<td>\"\n\npercentChange\n\ntoFixed\n\n\"%</td>\"\n\nThe percentChangeCalc function calculates the percentage difference between two numbers, avoiding division by zero. The percentChangeRow function allows us to style gains and losses differently by adding classes that we've already declared in the page's CSS.\n\nFinally, we need to add some code to periodically refetch our portfolio, so that we can see the newest price data. We'll use JavaScript's setInterval function for this. Add the following code just above the closing </script> tag.\n\n// refresh portfolio every 60 seconds\n\nsetInterval\n\nfunction\n\ngetPortfolio\n\n60000\n\nRun your repl, add some stocks if you haven't, and you should see something like this:\n\nFrom this point on, we highly recommend viewing your application in a new browser tab rather than Replit's in-page browser, to get the full-page dashboard experience.\n\nCaching\u200b\n\nOur dashboard is feature-complete, but a bit slow. As we're rendering it with client-side JavaScript that has to execute in the user's browser, we won't be able to make it load instantly with the rest of the page, but we can do some server-side caching to speed it up a little and reduce the load on our repl.\n\nCurrently, whenever we send a request to the /portfolio endpoint, we execute get_price on each of our stocks and rescrape Yahoo Finance to find their prices. Under normal conditions, stock prices are unlikely to change significantly moment-to-moment, and our dashboard is not a high-frequency trading platform, so we should write some logic to store the current share price and only renew it if it's more than 60 seconds old. Let's do this now.\n\nAs we're going to be modifying the database structure in this section, it's a good idea to flush your repl's database before going any further, so as to avoid errors.\n\nFirst, we'll import the time module, near the top of main.py.\n\nimport\n\ntime\n\nThis allows us to use time.time(), which returns the current Unix Epoch, a useful value for counting elapsed time in seconds. Add the following code to the buy function, just above the return statement:\n\ndb\n\n'shares'\n\nticker\n\n'current_price'\n\ncurrent_price\n\ndb\n\n'shares'\n\nticker\n\n'last_updated'\n\ntime\n\ntime\n\nThis code will add the current share price for each ticker and when it was last updated to our database.\n\nNow we need to modify the get_price function to resemble the code below:\n\ndef\n\nget_price\n\nticker\n\n# use cache if price is not stale\n\nif\n\nticker\n\nin\n\ndb\n\n\"shares\"\n\nkeys\n\nand\n\ntime\n\ntime\n\ndb\n\n\"shares\"\n\nticker\n\n\"last_updated\"\n\n60\n\nreturn\n\ndb\n\n\"shares\"\n\nticker\n\n\"current_price\"\n\npage\n\nrequests\n\nget\n\n\"https://finance.yahoo.com/quote/\"\n\nticker\n\nsoup\n\nBeautifulSoup\n\npage\n\ntext\n\n\"html5lib\"\n\nprice\n\nsoup\n\nfind\n\n'fin-streamer'\n\n'class'\n\n'Fw(b) Fz(36px) Mb(-4px) D(ib)'\n\ntext\n\n# remove thousands separator\n\nprice\n\nprice\n\nreplace\n\n\",\"\n\n\"\"\n\n# update price in db\n\nif\n\nticker\n\nin\n\ndb\n\n\"shares\"\n\nkeys\n\ndb\n\n\"shares\"\n\nticker\n\n\"current_price\"\n\nprice\n\ndb\n\n\"shares\"\n\nticker\n\n\"last_updated\"\n\ntime\n\ntime\n\nreturn\n\nprice\n\nThe if statement at the top will cause the function to return the current price recorded in our database if it has been fetched recently, and the two new lines near the bottom of the function will ensure that when a new price is fetched, it gets recorded in the database, along with an updated timestamp.\n\nYou can play around with different caching time periods in this function and different refresh intervals in the JavaScript code to find the right tradeoff between accurate prices and fast load times.\n\nWhere Next?\u200b\n\nOur stock dashboard is functional, and even useful to an extent, but there's still a lot more we could do with it. The following features would be good additions:\n\nSupport for fractional shares.\n\nThe ability to record the sale of shares.\n\nTimestamps for purchase (and sale) records.", "start_char_idx": 16517, "end_char_idx": 20851, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "37944587-552b-48b6-b876-78d63c8f6cb5": {"__data__": {"id_": "37944587-552b-48b6-b876-78d63c8f6cb5", "embedding": null, "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7", "node_type": "4", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "8c686cfaa5a3a539677cee8b09c7fed8e05cc65b33468322e85c6d9255e08982", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "de22991b-ad66-47c0-ba15-a5df7a4a171b", "node_type": "1", "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}, "hash": "afbcd5bee62604c4e5a744d0624b7fc695f1e33077cd7683c3b635722543248c", "class_name": "RelatedNodeInfo"}}, "hash": "377042580c678d0a4b4630311482d4ed064ecba0352d53ab9f3cc2fc8bdda61e", "text": "You can play around with different caching time periods in this function and different refresh intervals in the JavaScript code to find the right tradeoff between accurate prices and fast load times.\n\nWhere Next?\u200b\n\nOur stock dashboard is functional, and even useful to an extent, but there's still a lot more we could do with it. The following features would be good additions:\n\nSupport for fractional shares.\n\nThe ability to record the sale of shares.\n\nTimestamps for purchase (and sale) records.\n\nSupport for cryptocurrencies, perhaps using data from CoinMarketCap.\n\nThe ability to create multiple portfolios or user accounts.\n\nGraphs.\n\nYou can find the code for this tutorial in the repl below:\n\n< Previous: PDF report generator from spreadsheet\n\nNext: Spotify API tutorials >\n\nWas this helpful?\n\nLast updated on Aug 31, 2023\n\nCreating the Dashboard\n\nAccessing the Database and Recording Purchases\n\nFlushing the Database\n\nServing Our Portfolio Data\n\nFetching Current Prices\n\nShowing Our Portfolio\n\nCaching\n\nWhere Next?", "start_char_idx": 20354, "end_char_idx": 21375, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}}, "docstore/ref_doc_info": {"3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7": {"node_ids": ["428f5bae-7031-4b58-95ec-ab7201d0ea5c", "1728c083-3dfb-4645-a693-aaf284e9d6b0", "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8", "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1", "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5", "de22991b-ad66-47c0-ba15-a5df7a4a171b", "37944587-552b-48b6-b876-78d63c8f6cb5"], "metadata": {"path": "/home/runner/replit-docs-qa-with-llamaindex/docs.replit.com/tutorials/python/personal-stock-market-dashboard.html"}}}, "docstore/metadata": {"428f5bae-7031-4b58-95ec-ab7201d0ea5c": {"doc_hash": "441d3321f26b685ba74d333221a32edc46638ebd31fcbfc1f68fedf1236f4d76", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "1728c083-3dfb-4645-a693-aaf284e9d6b0": {"doc_hash": "b94c14080b1bb14600d428276a604af1f09522f8d419f781137111c80f246147", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "e6b9e2a2-f157-4ba9-94c6-996f6f0ca8e8": {"doc_hash": "3f66df16ec7eca763b953c1cae04bd1d0ea00367ad0dddb060a692b0fe3d641d", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "10d6a4a2-2e0a-4b9a-9d3b-bd2455f51cd1": {"doc_hash": "d199eee34e9175aba96285ebe177f7c31bc73a7449ebe8a32d7d5b91cd01a7b8", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "b4b6cab5-e79e-41cd-bee2-b0a83b9c11a5": {"doc_hash": "817985f8cdb4a41f678addded68ab1594387377e0643b36da29df7e00a5bc6f1", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "de22991b-ad66-47c0-ba15-a5df7a4a171b": {"doc_hash": "afbcd5bee62604c4e5a744d0624b7fc695f1e33077cd7683c3b635722543248c", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}, "37944587-552b-48b6-b876-78d63c8f6cb5": {"doc_hash": "377042580c678d0a4b4630311482d4ed064ecba0352d53ab9f3cc2fc8bdda61e", "ref_doc_id": "3fdcbe56-c22b-49ac-a3e1-5fc2c3e90cf7"}}}